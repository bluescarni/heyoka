
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Computations in arbitrary precision &#8212; heyoka 0.22.0 documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Serialisation" href="tut_s11n.html" />
    <link rel="prev" title="Computations in extended precision" href="tut_extended_precision.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">heyoka 0.22.0 documentation</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="install.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="basic_tutorials.html">
   Basic tutorials
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="tut_taylor_method.html">
     Taylor’s method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_expression_system.html">
     The expression system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_adaptive.html">
     The adaptive integrator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_adaptive_custom.html">
     Customising the adaptive integrator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_param.html">
     Runtime parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_nonauto.html">
     Non-autonomous systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_d_output.html">
     Dense &amp; continuous output
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_events.html">
     Event detection
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="advanced_tutorials.html">
   Advanced tutorials
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="tut_batch_mode.html">
     Batch mode
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_extended_precision.html">
     Computations in extended precision
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Computations in arbitrary precision
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_s11n.html">
     Serialisation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_ensemble.html">
     Ensemble propagations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_parallel_mode.html">
     Parallel mode
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="benchmarks.html">
   Benchmarks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ad_notes.html">
   Notes on automatic differentiation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="breaking_changes.html">
   Breaking changes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="acknowledgement.html">
   Acknowledgement
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/tut_arbitrary_precision.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/bluescarni/heyoka"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/bluescarni/heyoka/issues/new?title=Issue%20on%20page%20%2Ftut_arbitrary_precision.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-simple-example">
   A simple example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-classes-and-functions">
   Other classes and functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extended-vs-arbitrary-precision">
   Extended vs arbitrary precision
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="computations-in-arbitrary-precision">
<span id="tut-arbitrary-precision"></span><h1>Computations in arbitrary precision<a class="headerlink" href="#computations-in-arbitrary-precision" title="Permalink to this heading">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.20.0.</span></p>
</div>
<p>In addition to <a class="reference internal" href="tut_extended_precision.html#tut-extended-precision"><span class="std std-ref">extended-precision computations</span></a>, heyoka also supports
computations in <em>arbitrary</em> precision. In arbitrary-precision computations the user can
decide at runtime the number of bits of precision to be employed in the representation
of floating-point numbers. The precision is limited, in principle, only by the available
memory.</p>
<p>As explained in the <a class="reference internal" href="install.html#installation"><span class="std std-ref">installation instructions</span></a>, arbitrary-precision mode
requires heyoka to be compiled with support for the <a class="reference external" href="https://bluescarni.github.io/mppp/">mp++</a>
multiprecision library. The mp++ library, in turn, must be compiled
with the <code class="docutils literal notranslate"><span class="pre">MPPP_WITH_MPFR</span></code> option enabled (see the <a class="reference external" href="https://bluescarni.github.io/mppp/installation.html#installation" title="(in mp++ v0.27)"><span class="xref std std-ref">mp++ installation instructions</span></a>).</p>
<p>Arbitrary-precision floating-point values are represented in heyoka via the mp++ <a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv4N4mppp4realE" title="(in mp++ v0.27)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">mppp::real</span></code></a> class.
We refer the reader to the <a class="reference external" href="https://bluescarni.github.io/mppp/tutorial_real.html#tutorial-real" title="(in mp++ v0.27)"><span class="xref std std-ref">mp++ tutorial</span></a> for a quick overview of the main features
of this class. For the purposes of this tutorial, it is sufficient to note how <a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv4N4mppp4realE" title="(in mp++ v0.27)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">mppp::real</span></code></a> largely
behaves like a builtin floating-point type, the only difference being that the number of digits in the significand
can be set at runtime.</p>
<section id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this heading">¶</a></h2>
<p>In this tutorial, we will repeat the simple pendulum integration from the
<a class="reference internal" href="tut_extended_precision.html#tut-extended-precision"><span class="std std-ref">extended-precision tutorial</span></a>, but this time
in <a class="reference external" href="https://en.wikipedia.org/wiki/Octuple-precision_floating-point_format">octuple precision</a>.
The number of binary digits in this representation is 237, corresponding to circa 71 decimal digits.</p>
<p>Let us begin as usual with the definition of the dynamical equations and the creation of the integrator object:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Create the symbolic variables x and v.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_vars</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Setup the precision.</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">mpfr_prec_t</span><span class="w"> </span><span class="n">prec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">237</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Create the integrator object</span>
<span class="w">    </span><span class="c1">// in octuple precision.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taylor_adaptive</span><span class="o">&lt;</span><span class="n">mppp</span><span class="o">::</span><span class="n">real</span><span class="o">&gt;</span><span class="p">{</span><span class="c1">// Definition of the ODE system:</span>
<span class="w">                                          </span><span class="c1">// x&#39; = v</span>
<span class="w">                                          </span><span class="c1">// v&#39; = -9.8 * sin(x)</span>
<span class="w">                                          </span><span class="p">{</span><span class="n">prime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">prime</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span>
<span class="w">                                          </span><span class="c1">// Initial conditions</span>
<span class="w">                                          </span><span class="c1">// for x and v.</span>
<span class="w">                                          </span><span class="p">{</span><span class="n">mppp</span><span class="o">::</span><span class="n">real</span><span class="p">{</span><span class="mf">-1.</span><span class="p">,</span><span class="w"> </span><span class="n">prec</span><span class="p">},</span><span class="w"> </span><span class="n">mppp</span><span class="o">::</span><span class="n">real</span><span class="p">{</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="n">prec</span><span class="p">}}};</span>
</pre></div>
</div>
<p>In order to activate arbitrary precision, we created an integrator object of type <code class="docutils literal notranslate"><span class="pre">taylor_adaptive&lt;mppp::real&gt;</span></code> - that is,
we specified <a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv4N4mppp4realE" title="(in mp++ v0.27)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">mppp::real</span></code></a>, instead of the usual <code class="docutils literal notranslate"><span class="pre">double</span></code>, as the (only) template parameter for the <code class="docutils literal notranslate"><span class="pre">taylor_adaptive</span></code>
class template. The initial conditions were also initialised as a vector of <a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv4N4mppp4realE" title="(in mp++ v0.27)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">mppp::real</span></code></a>, and each value in the initial
state vector was created with a precision of 237 bits. The precision of an <a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv4N4mppp4realE" title="(in mp++ v0.27)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">mppp::real</span></code></a> is represented in mp++ via the
<a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv411mpfr_prec_t" title="(in mp++ v0.27)"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">mpfr_prec_t</span></code></a> type (an alias for a signed integral type).</p>
<p>Like in <a class="reference internal" href="tut_extended_precision.html#tut-extended-precision"><span class="std std-ref">extended-precision mode</span></a>, in an arbitrary-precision integrator
<em>all</em> numerical values encapsulated in an integrator are represented in arbitrary precision - this includes not only the state vector,
but also the time coordinate, the tolerance, the Taylor coefficients, etc. Each arbitrary-precision integrator has a global
precision value which is specified or inferred upon construction. This global precision
value can be accessed after construction via the <code class="docutils literal notranslate"><span class="pre">get_prec()</span></code> member function.</p>
<p>The precision value for an integrator can either be inferred from the initial state vector, as we saw in the
code snippet above, or it can be explicitly passed as the <code class="docutils literal notranslate"><span class="pre">prec</span></code> keyword argument. That is, an alternative,
but equivalent, way of constructing a 237-bit integrator would be:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taylor_adaptive</span><span class="o">&lt;</span><span class="n">mppp</span><span class="o">::</span><span class="n">real</span><span class="o">&gt;</span><span class="p">{</span><span class="c1">// Definition of the ODE system:</span>
<span class="w">                                      </span><span class="c1">// x&#39; = v</span>
<span class="w">                                      </span><span class="c1">// v&#39; = -9.8 * sin(x)</span>
<span class="w">                                      </span><span class="p">{</span><span class="n">prime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">prime</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span>
<span class="w">                                      </span><span class="c1">// Initial conditions</span>
<span class="w">                                      </span><span class="c1">// for x and v.</span>
<span class="w">                                      </span><span class="p">{</span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">},</span>
<span class="w">                                      </span><span class="c1">// Explicitly set the precision.</span>
<span class="w">                                      </span><span class="n">kw</span><span class="o">::</span><span class="n">prec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">237</span>
<span class="w">                                      </span><span class="p">};</span>
</pre></div>
</div>
<p>Regardless of how the integrator’s precision is specified, all the numerical values encapsulated in the
integrator in addition to the state vector (that is, the time coordinate, the parameter values, the Taylor coefficients, etc.) are initialised
with the same precision upon construction. If at any time after construction
the user changes the precision of the internal data of the integrator, any successive attempt to continue the numerical
integration will result in an exception being raised.
In other words, heyoka will not accept any change to the precision of the numerical data stored within an
arbitrary-precision integrator after construction.</p>
<p>Let us print to screen the integrator object:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Print the integrator object to screen.</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Precision               : 237 bits</span>
<span class="go">Tolerance               : 9.055679078826712367509119290887791780682531198139138189582614889935501319e-72</span>
<span class="go">High accuracy           : false</span>
<span class="go">Compact mode            : true</span>
<span class="go">Taylor order            : 83</span>
<span class="go">Dimension               : 2</span>
<span class="go">Time                    : 0.000000000000000000000000000000000000000000000000000000000000000000000000</span>
<span class="go">State                   : [-1.000000000000000000000000000000000000000000000000000000000000000000000000, 0.000000000000000000000000000000000000000000000000000000000000000000000000]</span>
</pre></div>
</div>
<p>The screen output indeed confirms that the precision was correctly inferred to be 237 bits from the initial conditions.
Similarly to double-precision and extended-precision integrators, the tolerance is set by default to the machine epsilon
corresponding to the inferred precision.</p>
<p>An important change in the defaults with respect to double-precision and extended-precision integrators is that, in
arbitrary-precision integrators, <a class="reference internal" href="tut_adaptive_custom.html#tut-compact-mode"><span class="std std-ref">compact mode</span></a> is <strong>on</strong> by default, rather than off.
This change is motivated by the fact that the Taylor order of arbitrary-precision integrators will typically be
much higher than in double-precision and extended-precision integrators, which results in very long compilation
times even for simple ODEs. Moreover, in arbitrary-precision integrators compact mode does not bring performance
improvements due to the fact that most numerical computations are offloaded to the mp++ library (rather than
being implemented directly in LLVM).</p>
<p>We proceed now to the definition of a small helper function that will allow us to monitor the evolution of the energy constant
throughout the integration. As we mentioned earlier, the <a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv4N4mppp4realE" title="(in mp++ v0.27)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">mppp::real</span></code></a> class can be used like a builtin floating-point type, thus we can
copy without changes and re-use the generic <code class="docutils literal notranslate"><span class="pre">compute_energy</span></code> helper function from the
<a class="reference internal" href="tut_extended_precision.html#tut-extended-precision"><span class="std std-ref">extended-precision tutorial</span></a>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Create a small helper to compute the energy constant</span>
<span class="w">    </span><span class="c1">// from the state vector.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">compute_energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">sv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">sv</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
<span class="w">    </span><span class="p">};</span>
</pre></div>
</div>
<p>Before starting the integration, we compute and store the initial energy for later use:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Compute and store the intial energy.</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">orig_E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_energy</span><span class="p">(</span><span class="n">ta</span><span class="p">.</span><span class="n">get_state</span><span class="p">());</span>
</pre></div>
</div>
<p>We can now begin a step-by-step integration. At the end of each step, we will be computing
and printing to screen the relative energy error:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Integrate for a few timesteps.</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">;</span>

<span class="w">        </span><span class="n">ta</span><span class="p">.</span><span class="n">step</span><span class="p">();</span>

<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Relative energy error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">abs</span><span class="p">((</span><span class="n">orig_E</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">compute_energy</span><span class="p">(</span><span class="n">ta</span><span class="p">.</span><span class="n">get_state</span><span class="p">()))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">orig_E</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 0</span>
<span class="go">Relative energy error: 0</span>
<span class="go">Relative energy error: 0</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 1.6081e-71</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 1.6081e-71</span>
<span class="go">Relative energy error: 1.6081e-71</span>
<span class="go">Relative energy error: 1.6081e-71</span>
<span class="go">Relative energy error: 1.6081e-71</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 0</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 1.6081e-71</span>
<span class="go">Relative energy error: 8.04049e-72</span>
<span class="go">Relative energy error: 1.6081e-71</span>
</pre></div>
</div>
<p>The console output indeed confirms that energy is conserved at the level of the epsilon of the octuple-precision
format (that is, <span class="math notranslate nohighlight">\(\sim 10^{-71}\)</span>).</p>
</section>
<section id="other-classes-and-functions">
<h2>Other classes and functions<a class="headerlink" href="#other-classes-and-functions" title="Permalink to this heading">¶</a></h2>
<p>Besides the adaptive integrator, several other classes and functions in heyoka can be used in arbitrary precision.</p>
<p>The <a class="reference internal" href="tut_events.html#tut-events"><span class="std std-ref">event classes</span></a>, for instance, can be constructed in arbitrary precision by passing <a class="reference external" href="https://bluescarni.github.io/mppp/real.html#_CPPv4N4mppp4realE" title="(in mp++ v0.27)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">mppp::real</span></code></a>
as the template parameter (instead of <code class="docutils literal notranslate"><span class="pre">double</span></code>). Note that arbitrary-precision events <strong>must</strong> be used in an arbitrary-precision
integrator, otherwise an error will be produced at compilation time.</p>
</section>
<section id="extended-vs-arbitrary-precision">
<h2>Extended vs arbitrary precision<a class="headerlink" href="#extended-vs-arbitrary-precision" title="Permalink to this heading">¶</a></h2>
<p>In general, if your architecture supports <a class="reference internal" href="tut_extended_precision.html#tut-extended-precision"><span class="std std-ref">extended-precision data types</span></a> and their precision
is sufficient, you should prefer extended-precision integrations over arbitrary-precision integrations, as the former
will provide better performance.</p>
<p>On the other hand, arbitrary-precision integrations can satisfy any precision requirement, and they are available on all
platforms, even where there are no extended-precision data types (e.g., on Windows).</p>
</section>
</section>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="tut_extended_precision.html" title="previous page">Computations in extended precision</a>
    <a class='right-next' id="next-link" href="tut_s11n.html" title="next page">Serialisation</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Francesco Biscani, Dario Izzo<br/>
        
            &copy; Copyright 2020, 2021, 2022 Francesco Biscani, Dario Izzo.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>