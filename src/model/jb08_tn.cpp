// Copyright 2020-2025 Francesco Biscani (bluescarni@gmail.com), Dario Izzo (dario.izzo@gmail.com)
//
// This file is part of the heyoka library.
//
// This Source Code Form is subject to the terms of the Mozilla
// Public License v. 2.0. If a copy of the MPL was not distributed
// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

#include <stdexcept>
#include <utility>
#include <vector>

#include <boost/math/constants/constants.hpp>

#include <heyoka/config.hpp>
#include <heyoka/expression.hpp>
#include <heyoka/kw.hpp>
#include <heyoka/math/cos.hpp>
#include <heyoka/math/exp.hpp>
#include <heyoka/math/sin.hpp>
#include <heyoka/math/sum.hpp>
#include <heyoka/math/tanh.hpp>
#include <heyoka/model/ffnn.hpp>
#include <heyoka/model/jb08_tn.hpp>

HEYOKA_BEGIN_NAMESPACE

namespace model::detail
{

namespace
{

const double best_global_fit[12]
    = {4.8324408000550755e-14, 1.1317738349607241e-10, 2.4103868610236823e-08, 4.1365331722514101e-09,
       3.6156275901554277e-03, 1.7183286142392017e-02, 5.1228686578056189e-02, 2.6315796482795122e-02,
       1.5394267177079062e+01, 9.9995283706628030e+01, 9.0742221828371825e+01, 5.7489799315626591e+01};

const double flattened_nw[1996]
    = {-0.3161968886852264, 0.7200070619583130,  0.4266059994697571,  0.4462889134883881,  0.5300100445747375,
       0.0113589065149426,  -0.0225996337831020, -0.0153983095660806, -0.1053199768066406, -0.0938813388347626,
       0.1337043941020966,  -0.0163733921945095, -0.0088550606742501, 0.0159765128046274,  -0.0276741776615381,
       0.0927821695804596,  0.0491763949394226,  0.0225073490291834,  -0.0872274190187454, 0.0071645751595497,
       -0.0225133504718542, -0.2340203076601028, -0.8085952997207642, -0.0859029963612556, -0.1663629263639450,
       0.0140318563207984,  0.1464723646640778,  0.0557565502822399,  0.0247385948896408,  -0.0543991550803185,
       0.0986486375331879,  -0.1365858465433121, -0.6349130272865295, 0.1084856018424034,  0.7113832235336304,
       0.4548044800758362,  -0.5391722321510315, -0.0120813334360719, 0.0031749261543155,  0.0719653517007828,
       -0.1103921905159950, -0.0156760960817337, 0.0663103237748146,  -0.0455116182565689, 0.0859210267663002,
       0.0281957369297743,  -0.0540092028677464, -0.0107791563495994, -0.4720899462699890, -0.3488308191299438,
       -0.3699450492858887, 0.1298538446426392,  0.3786000609397888,  -0.0337696261703968, 0.0355664789676666,
       0.0230922102928162,  0.1904641836881638,  0.0062931785359979,  -0.1223333701491356, 0.0636473670601845,
       -0.0711331963539124, 0.0086521962657571,  0.0240621455013752,  0.1646520793437958,  0.2040761113166809,
       -0.6634814143180847, 0.7564994692802429,  -0.5482558012008667, -0.4674583673477173, -0.0268746279180050,
       0.0379682108759880,  0.0320056900382042,  0.0224058348685503,  -0.0999370515346527, 0.0568224936723709,
       0.0629212930798531,  -0.0375560559332371, 0.0007036825991236,  -0.0513932891190052, -0.0430316478013992,
       -0.0256966147571802, 0.0104539301246405,  -0.0611109659075737, -0.0473438799381256, 0.0326430015265942,
       -0.6738665103912354, 0.2654511034488678,  -0.1062021926045418, 0.0266870781779289,  -0.0471410006284714,
       -0.0658260583877563, 0.0467427000403404,  0.1027109399437904,  -0.0253750514239073, 0.0478711910545826,
       -0.1376557201147079, 0.0982975661754608,  0.0586437247693539,  0.8301183581352234,  0.0330005809664726,
       -0.2255796194076538, 0.0108781997114420,  -0.1519928127527237, -0.0310609303414822, 0.1476303637027740,
       0.0330741032958031,  -0.0618379451334476, 0.0566914118826389,  -0.0685181692242622, -0.0200718231499195,
       0.0118181370198727,  0.3025861680507660,  0.7341203689575195,  1.2243019342422485,  0.1768955886363983,
       -1.3935370445251465, 0.1444234251976013,  0.0272267889231443,  0.0365737974643707,  -0.0449699498713017,
       -0.0675669535994530, 0.0055833202786744,  0.0377207659184933,  0.0511778742074966,  0.0460232570767403,
       -0.0274093858897686, 0.0249631647020578,  0.0990505591034889,  -0.1862262636423111, -0.0014162146253511,
       0.4507656991481781,  0.0520084276795387,  0.1126069873571396,  0.1325288116931915,  -0.1816045641899109,
       0.0774144530296326,  0.0590604767203331,  -0.1539281755685806, -0.0003204071545042, 0.0604530163109303,
       -0.1184741482138634, -0.0563300214707851, 0.1382705420255661,  -0.1994231492280960, 0.4154501259326935,
       0.5665765404701233,  -0.7626270055770874, 0.1652081161737442,  0.6960451006889343,  0.0161898210644722,
       -0.0145160164684057, 0.0451042652130127,  -0.1004513651132584, -0.0171262659132481, 0.0848458483815193,
       -0.0012561056064442, 0.0028071915730834,  0.0252270530909300,  0.0138853779062629,  0.0099763385951519,
       -0.5174123048782349, 0.4284989833831787,  -0.8550262451171875, 0.6178700327873230,  0.1100296154618263,
       0.0047413120046258,  -0.0430536270141602, 0.0350719615817070,  -0.0511128157377243, -0.0948455408215523,
       0.1096293553709984,  0.0251105353236198,  0.0031269404571503,  0.0076160649769008,  -0.0413643456995487,
       -0.0052849152125418, -0.0147462142631412, -0.0049960780888796, -0.0230998843908310, 0.0210891272872686,
       -0.0427928604185581, -0.0617060400545597, 0.1192183420062065,  -0.2129605561494827, -0.4809049367904663,
       -0.0440788492560387, 0.4062596857547760,  -0.0803868100047112, -0.0788943693041801, 0.0243188403546810,
       -0.1291480809450150, -0.0448984988033772, -0.0126713309437037, 0.0147301945835352,  0.0722118392586708,
       -0.0020972131751478, 0.0165877658873796,  0.5236784815788269,  -0.2263872474431992, 0.0083678383380175,
       0.7063104510307312,  0.0415582768619061,  -0.6084469556808472, -0.0571274794638157, -0.1227235123515129,
       0.0192301366478205,  0.0220344625413418,  -0.0420252904295921, -0.0351335331797600, 0.2118996977806091,
       -0.3447560071945190, -0.0844403952360153, 0.0176223348826170,  -0.2009699791669846, -0.4760889112949371,
       0.0611316226422787,  0.1011446490883827,  -0.0997591018676758, -0.0239436589181423, 0.0426813364028931,
       -0.0925096422433853, 0.0064341998659074,  -0.0274081826210022, -0.0763377025723457, 0.4565655291080475,
       -0.4049325585365295, -0.6958517432212830, -0.5641261339187622, -0.0571381971240044, 0.0093953823670745,
       -0.0192371886223555, -0.0132776955142617, -0.0028795422986150, 0.0430128760635853,  -0.0135507155209780,
       -0.0296085104346275, 0.0333357267081738,  0.0188532266765833,  -0.0365835800766945, 0.0334286130964756,
       -0.2827052772045135, -0.0668836757540703, 0.9142929911613464,  -0.0963105931878090, 0.0525544397532940,
       -0.0058519314043224, -0.1897153556346893, -0.0206407662481070, 0.0791846439242363,  0.0171068143099546,
       -0.0430890247225761, 0.0406365208327770,  -0.0334085337817669, 0.0225161053240299,  -0.0392673499882221,
       0.2357053309679031,  -0.0485407970845699, 0.0535394176840782,  -0.0271081775426865, 0.0477456450462341,
       -0.0350286476314068, 0.0298152994364500,  0.0113233560696244,  -0.0270512588322163, 0.0944576114416122,
       0.3147419393062592,  -0.0559125430881977, 0.0158877540379763,  -0.0667789876461029, 0.0352856777608395,
       -0.1759145259857178, 0.3116804957389832,  0.0348417460918427,  0.0414643287658691,  0.5615261793136597,
       0.2049766629934311,  0.0505360215902328,  -0.2421587258577347, 0.4095007181167603,  -0.0550792738795280,
       -0.2409754991531372, -0.0333179123699665, 0.1853969544172287,  0.0743888169527054,  -0.0823515430092812,
       -0.0560999363660812, 0.1197844147682190,  -0.0472912751138210, 0.0340901166200638,  0.0175268761813641,
       -0.0508840866386890, 0.0002971360227093,  -0.0179762393236160, 0.3258975744247437,  0.8354494571685791,
       -0.0224140249192715, -0.0243117492645979, 0.0607839561998844,  0.0059001343324780,  0.0453312806785107,
       -0.0399724133312702, -0.0513355210423470, 0.0768919065594673,  -0.0619653910398483, -0.0139079596847296,
       0.0379898361861706,  0.3156596720218658,  0.0119906608015299,  0.0349444039165974,  -0.2516982257366180,
       0.2449031472206116,  -0.0987127125263214, 0.3973995447158813,  0.0137602211907506,  -0.3830170929431915,
       0.0579143241047859,  -0.1153014600276947, -0.0472293384373188, 0.0670010522007942,  0.0859322622418404,
       -0.0711026713252068, 0.0110752321779728,  -0.1208786219358444, -0.0026978251989931, 0.0164006315171719,
       0.0268301069736481,  0.0708709061145782,  0.1257350891828537,  0.1300017833709717,  0.4541369080543518,
       0.0180054511874914,  0.0800459757447243,  -0.0323250181972980, 0.0435215383768082,  0.0462105013430119,
       0.2769401371479034,  0.2985258996486664,  -0.2048083394765854, -0.3234175741672516, 0.2646062672138214,
       -0.0551314763724804, -0.0021473730448633, 0.0073883766308427,  -0.0154996514320374, 0.3023306727409363,
       0.1294761300086975,  -0.2286398559808731, 0.0123054701834917,  -0.0671876817941666, -0.0278383996337652,
       0.0417195931077003,  0.2828937768936157,  0.0237439405173063,  0.0457411222159863,  0.0794661790132523,
       0.0327969789505005,  -0.0154054714366794, 0.4690646827220917,  -0.2241199612617493, 0.0431879758834839,
       -0.1333310902118683, 0.0166168995201588,  0.0747931152582169,  -0.0504352115094662, -0.2201241105794907,
       0.0042628385126591,  -0.0473359934985638, -0.3312458395957947, -0.5022053718566895, -0.3145841062068939,
       -0.8503579497337341, 0.0998731106519699,  -0.5757308602333069, 0.0198877975344658,  -0.0533550530672073,
       0.0775390043854713,  -0.0247899871319532, -0.1059147939085960, 0.1173624694347382,  0.0644320622086525,
       -0.0280171837657690, -0.0136531358584762, -0.0228076428174973, 0.0534244850277901,  -0.0081863263621926,
       -0.1661574989557266, 0.1751711219549179,  -0.0046579926274717, 0.0032543281558901,  -0.0372356139123440,
       -0.2062753885984421, -0.0010571457678452, -0.3984514176845551, 0.0071320901624858,  0.3161819577217102,
       -0.0032500000670552, 0.0873860418796539,  0.0150464950129390,  0.0244487673044205,  0.2020548582077026,
       0.0079673379659653,  -0.1391656100749969, 0.4721501171588898,  0.0408254414796829,  0.2966649830341339,
       -0.0501516871154308, -0.0267745405435562, 0.0561503358185291,  0.1939177066087723,  -0.0933235585689545,
       0.0083781573921442,  -0.0217315256595612, 0.1532782614231110,  0.0459579825401306,  -0.1477611958980560,
       -0.2328913211822510, 0.4799343347549438,  -0.4639233648777008, 0.3871605396270752,  0.2113653421401978,
       -0.5980637669563293, 0.1119687631726265,  -0.0513666123151779, -0.1349688470363617, -0.0887820050120354,
       0.1497880667448044,  -0.0024513450916857, -0.0109065501019359, 0.0367531999945641,  0.0085310302674770,
       -0.0024046991020441, -0.1134354099631310, -0.1269984692335129, -0.2953177094459534, -0.1342946141958237,
       -0.2179640680551529, -0.2513587176799774, -0.0077649415470660, 0.0587621033191681,  -0.0868689492344856,
       0.0827388241887093,  -0.1414287835359573, -0.0066262185573578, 0.0935313105583191,  -0.0181660428643227,
       -0.0715776309370995, 0.0013921504141763,  -0.2380979508161545, -0.0557851940393448, 0.2161282151937485,
       0.2954589426517487,  0.2357932329177856,  -0.1036671251058578, -0.0323708951473236, -0.0230534374713898,
       0.1079202666878700,  -0.0313060432672501, -0.2591307163238525, 0.0948646664619446,  0.0487613752484322,
       -0.0124923894181848, -0.0569562576711178, 0.1058677509427071,  -0.2098431885242462, -0.5368540883064270,
       -0.0809565633535385, -0.3688785731792450, 0.2143497020006180,  -0.3270181119441986, -0.0480422899127007,
       0.1821273267269135,  -0.0313689261674881, -0.0157565958797932, 0.0292666871100664,  0.0518703982234001,
       0.0927941724658012,  -0.1105942726135254, -0.0533454008400440, 0.1798256188631058,  0.0384650528430939,
       0.1534110754728317,  -0.2735652029514313, 0.3667117655277252,  0.2610865533351898,  0.0543260909616947,
       0.0367481857538223,  -0.1095994859933853, 0.0384719632565975,  -0.1378114223480225, 0.0414536036550999,
       0.0041920286603272,  -0.1032141298055649, 0.0225891973823309,  0.0250605475157499,  -0.0203754939138889,
       -0.2200863957405090, 0.3164318501949310,  0.0824578255414963,  0.1409697383642197,  -0.1565132886171341,
       0.4036286771297455,  -0.0643892660737038, 0.2030493617057800,  -0.2285606861114502, -0.0203302428126335,
       0.0300345215946436,  -0.0840323194861412, 0.0343796312808990,  -0.0705695375800133, -0.0807482898235321,
       0.1034954339265823,  0.0880153775215149,  -0.0021356248762459, 0.0466447360813618,  -0.2490911036729813,
       -0.0655636638402939, -0.3409383594989777, 0.1328638643026352,  -0.0627416297793388, 0.1742756217718124,
       0.1582561880350113,  -0.1340385824441910, 0.4590494036674500,  -0.0750606209039688, 0.0013727945042774,
       0.0203135740011930,  0.1519842892885208,  -0.2696816325187683, 0.0981632471084595,  0.0124766454100609,
       0.0179943200200796,  -0.1413115859031677, -0.0243807435035706, 0.2726193070411682,  0.0438474528491497,
       -0.2412231117486954, -0.1115550696849823, -0.0660728886723518, -0.1214156895875931, 0.0494117364287376,
       -0.1531527042388916, -0.2528665065765381, 0.2378685623407364,  -0.1106122061610222, -0.0093650594353676,
       0.3130072355270386,  0.1857063025236130,  -0.1222624033689499, -0.0050521213561296, -0.1433647274971008,
       -0.0755307301878929, -0.0132277915254235, -0.0380014516413212, -0.0042992806993425, -0.0119237257167697,
       0.0902601629495621,  0.0005103161092848,  0.0774568840861320,  0.0049578738398850,  -0.1103425696492195,
       0.0479274243116379,  0.0106684621423483,  0.0976315364241600,  0.0548351444303989,  -0.1414544284343719,
       -0.1143000423908234, 0.0409260615706444,  -0.0554066449403763, 0.0477195270359516,  0.2419232279062271,
       0.1845573484897614,  0.0248645041137934,  0.0229498464614153,  -0.0872749164700508, 0.1957082003355026,
       0.0901594683527946,  0.3102947771549225,  0.2133610248565674,  0.1275258064270020,  0.0905598029494286,
       0.3506413698196411,  -0.0948969200253487, 0.0454516261816025,  0.0868707224726677,  0.1526739448308945,
       0.2269007563591003,  0.1660619080066681,  0.0496037378907204,  0.0719470679759979,  -0.0119727673009038,
       -0.0271957386285067, -0.0045887897722423, -0.1525340974330902, 0.1653827875852585,  0.0067783342674375,
       0.1001489236950874,  0.2239414006471634,  -0.2201594412326813, 0.0710687339305878,  0.0786555856466293,
       -0.0279686078429222, 0.1958949267864227,  0.0687549114227295,  -0.0268748644739389, 0.0949144288897514,
       -0.0466618575155735, 0.1780932545661926,  -0.0263928230851889, 0.1564576178789139,  -0.0086209792643785,
       0.2337820380926132,  -0.1782084107398987, 0.2318317145109177,  -0.0228525847196579, -0.3534886538982391,
       -0.0019703656435013, 0.1944888979196548,  0.2598660290241241,  0.2129851281642914,  0.0644977316260338,
       -0.0327061824500561, 0.0787295624613762,  0.3892106711864471,  -0.3439695239067078, -0.4121409952640533,
       0.1971192508935928,  0.0466173514723778,  -0.1715675592422485, -0.6178983449935913, -0.5797644853591919,
       -0.0128433397039771, 0.3265763521194458,  -0.1814830005168915, 0.1478991657495499,  0.0226422455161810,
       0.0246087145060301,  0.0583548769354820,  0.0617496781051159,  0.4543812274932861,  0.0880160927772522,
       -0.1326768100261688, -0.2603549361228943, -0.2487790733575821, -0.1518682837486267, -0.2285267859697342,
       0.1519132107496262,  0.1321428567171097,  -0.0334955677390099, -0.2756333649158478, -0.2463581115007401,
       -0.1208035051822662, -0.1105605065822601, -0.7634650468826294, -0.1190642341971397, -0.1855385005474091,
       -0.0695096328854561, 0.1698165833950043,  0.2093907147645950,  0.2967846989631653,  -0.0674169957637787,
       -0.1196390539407730, -0.0312863290309906, -0.0312267504632473, -0.1254558414220810, -0.0558078177273273,
       0.2145907580852509,  -0.2574499547481537, 0.2211463600397110,  0.1289328932762146,  0.2352631092071533,
       0.1042369380593300,  0.0477362647652626,  0.0001495388423791,  0.0952157601714134,  -0.0186024960130453,
       0.1455106139183044,  -0.2046912163496017, -0.0011387465056032, -0.0647965595126152, 0.0269968844950199,
       0.0026558989193290,  0.0166917517781258,  0.0727803409099579,  0.1090580224990845,  -0.2377685159444809,
       -0.0854501202702522, 0.0038896172773093,  -0.2227983325719833, -0.2092856764793396, -0.2537006139755249,
       0.1827238351106644,  -0.0644475743174553, -0.1273702383041382, -0.1019307449460030, 0.0662186816334724,
       0.1113893091678619,  0.2830734550952911,  -0.0395914353430271, -0.1013961359858513, 0.1187117472290993,
       0.0419401936233044,  -0.1300210505723953, 0.0104438941925764,  -0.0691131129860878, 0.0790298655629158,
       -0.0585917979478836, -0.0147423576563597, 0.1626239717006683,  0.0716265738010406,  0.0161505322903395,
       -0.0691488459706306, -0.1370128989219666, -0.0324182808399200, 0.0823025181889534,  0.1516964435577393,
       0.0565641485154629,  -0.0753137245774269, 0.0798309445381165,  0.2342244386672974,  0.0746823176741600,
       -0.0904032364487648, -0.1711241453886032, -0.0562298670411110, 0.0429832674562931,  0.1263650357723236,
       0.2014141976833344,  0.0131260370835662,  0.2838297784328461,  0.0429664999246597,  -0.1760375350713730,
       0.1375985741615295,  0.1422562003135681,  0.0435618236660957,  0.0209922660142183,  0.0127110080793500,
       -0.1302933394908905, -0.0119142262265086, 0.0116917779669166,  0.2010753452777863,  0.1332976818084717,
       0.0845888182520866,  -0.1019402965903282, 0.1129179894924164,  -0.0477650798857212, -0.1946444213390350,
       0.1194748952984810,  -0.1925708800554276, -0.1602937579154968, -0.1393384635448456, 0.1040064319968224,
       0.0087261274456978,  0.0942197367548943,  -0.0155882928520441, 0.0640417411923409,  0.0411143824458122,
       -0.2302918434143066, -0.1750843375921249, 0.0289644896984100,  0.0368205830454826,  0.1358013302087784,
       -0.2340821176767349, -0.1016408279538155, 0.0866164490580559,  -0.0584424324333668, -0.1299713999032974,
       0.1200369298458099,  -0.1490639895200729, -0.2130997925996780, -0.0808504894375801, -0.2877098023891449,
       -0.0679428577423096, 0.0516974255442619,  -0.1244695484638214, 0.2037013173103333,  0.3100596368312836,
       -0.0412130393087864, 0.0144952032715082,  -0.0365487635135651, 0.0331227406859398,  -0.0564670786261559,
       0.5383632779121399,  0.0827648043632507,  0.1282758116722107,  0.0122231533750892,  0.0490696728229523,
       -0.1395773738622665, -0.2715118229389191, 0.2341692596673965,  -0.2104981839656830, -0.0953209698200226,
       -0.1893761157989502, -0.0029173162765801, -0.1428375244140625, 0.0510679185390472,  -0.2211486995220184,
       -0.0036134731490165, -0.0727511718869209, -0.1008663401007652, -0.0009584632352926, 0.1029766649007797,
       -0.2190862596035004, 0.2389182299375534,  -0.1880184710025787, 0.1271826028823853,  -0.3247060477733612,
       -0.2917365431785583, -0.0331889167428017, -0.1217255368828773, -0.2117680311203003, -0.3783442080020905,
       0.1550811082124710,  -0.0776372998952866, -0.1450313478708267, 0.2214136868715286,  -0.5597350597381592,
       0.2723923921585083,  -0.1779204308986664, 0.3089929521083832,  0.1958352327346802,  -0.2615936696529388,
       -0.0232399571686983, 0.1591164022684097,  -0.0483886972069740, -0.2921867966651917, -0.2054454535245895,
       0.0417996346950531,  -0.3884171247482300, -0.0849097222089767, -0.2857368290424347, -0.0289159808307886,
       -0.0141703579574823, -0.0149567387998104, 0.0145683912560344,  -0.1960245668888092, 0.2206682860851288,
       -0.1009222716093063, 0.0377974994480610,  0.3756938278675079,  -0.1168993115425110, 0.0719060748815536,
       -0.0173723492771387, -0.0226036943495274, 0.1404809653759003,  0.0716892406344414,  0.7416660189628601,
       0.0960450097918510,  0.0067517096176744,  -0.0326046645641327, -0.3705752491950989, 0.1193241551518440,
       -0.3746702969074249, 0.2957649528980255,  -0.1124429702758789, 0.1952458024024963,  -0.0081480005756021,
       0.1592003405094147,  -0.3870935142040253, 0.1532883644104004,  0.0533126480877399,  0.1039082780480385,
       -0.0161210931837559, 0.2159633934497833,  0.2009100019931793,  0.1246915608644485,  0.0533165559172630,
       0.1942525506019592,  0.1943560391664505,  -0.1850881129503250, -0.1049744710326195, 0.0510609298944473,
       0.0244898535311222,  0.2319802641868591,  0.0924052000045776,  0.1762289106845856,  -0.1920885145664215,
       0.1790992319583893,  0.2620458304882050,  -0.1082397848367691, -0.2658128440380096, -0.1998367905616760,
       0.4568817913532257,  -0.0126850428059697, -0.0263496078550816, 0.2266613394021988,  0.0104431640356779,
       -0.5839824080467224, -0.1940001845359802, 0.3215395510196686,  0.1497001945972443,  0.0104622449725866,
       0.1774288117885590,  -0.0112977754324675, 0.3229468464851379,  0.0193191543221474,  0.1528135687112808,
       -0.0604915954172611, -0.0067449617199600, 0.1300700753927231,  0.0597025193274021,  -0.0474018603563309,
       0.0597221665084362,  -0.2095303237438202, -0.0144266067072749, 0.0783538594841957,  0.1698625385761261,
       0.0452062450349331,  0.1709558516740799,  0.1517181843519211,  -0.2359967231750488, -0.0790211409330368,
       0.2145162969827652,  -0.1535817384719849, -0.2891795337200165, 0.1117814481258392,  0.1917959451675415,
       0.2137557566165924,  -0.2598645091056824, -0.0900128111243248, 0.0825265422463417,  0.0559144541621208,
       -0.0885496437549591, 0.1405087709426880,  -0.0911127701401711, -0.0064868601039052, 0.0923985540866852,
       0.0550772212445736,  0.0792122259736061,  0.0688929855823517,  -0.0099006546661258, 0.2932441830635071,
       0.1354977339506149,  -0.0536595061421394, 0.0196948479861021,  -0.3659609258174896, 0.0439445227384567,
       0.0491169914603233,  0.0615157075226307,  -0.0034836628474295, 0.1849571317434311,  0.2498660534620285,
       -0.6665057539939880, -0.0879490226507187, 0.1057639047503471,  -0.0076204417273402, -0.2866418957710266,
       0.1408721059560776,  0.3146561384201050,  -0.2660516798496246, -0.1926478445529938, -0.2083856016397476,
       0.1643968522548676,  0.1058797985315323,  0.3070380985736847,  0.0697249323129654,  -0.1032458245754242,
       -0.0891887620091438, -0.1255725175142288, -0.0269235782325268, 0.1130504235625267,  0.1094499304890633,
       -0.0462896712124348, -0.0505900979042053, -0.1007763743400574, 0.0396816805005074,  -0.0030698704067618,
       -0.0970724001526833, 0.1634292900562286,  -0.0659117847681046, -0.1535997837781906, 0.1410130411386490,
       -0.0657761245965958, -0.1835167258977890, -0.2285678386688232, -0.2314579635858536, -0.0456592999398708,
       0.2560711503028870,  0.2738989591598511,  0.0374679677188396,  0.2560552656650543,  -0.2050232440233231,
       0.1891517043113708,  -0.0574093982577324, -0.0774885267019272, 0.0704699605703354,  0.0513532273471355,
       -0.0990320593118668, -0.0769753679633141, -0.1006730720400810, -0.0307084619998932, 0.0751147121191025,
       -0.0146458689123392, -0.0946130305528641, 0.0681219622492790,  -0.0521040558815002, -0.1282975226640701,
       0.1864458024501801,  -0.0596901215612888, 0.1509835720062256,  0.1158129274845123,  0.1773816496133804,
       -0.1667286455631256, 0.1189187616109848,  -0.1121840626001358, -0.2021554112434387, 0.0673866271972656,
       0.0025918858591467,  0.0600687563419342,  0.0985181480646133,  0.3501649200916290,  -0.0405318289995193,
       -0.0431229658424854, 0.0460293292999268,  0.4089075326919556,  0.2357753217220306,  0.0918874591588974,
       -0.3151966929435730, 0.1693171560764313,  -0.0848885849118233, 0.0310618579387665,  -0.0239289216697216,
       0.0739988461136818,  -0.1090331003069878, -0.1893434971570969, -0.1608147621154785, -0.1206059977412224,
       0.0546752549707890,  -0.2255814671516418, 0.1994739770889282,  -0.3292326331138611, 0.0388498865067959,
       0.1622156351804733,  0.0843130350112915,  -0.4371675848960876, -0.2225059568881989, -0.0403585396707058,
       -0.0418938584625721, -0.2390223741531372, -0.1207359954714775, -0.0589703321456909, 0.2955057322978973,
       0.0292425602674484,  -0.1240375638008118, 0.1590286493301392,  -0.3098993003368378, 0.2750142514705658,
       0.2620458602905273,  0.0324859917163849,  -0.2042215615510941, 0.0456267297267914,  -0.1997570097446442,
       -0.1983758956193924, -0.0680608972907066, 0.0964956730604172,  0.1961574852466583,  -0.1773701459169388,
       -0.1724343150854111, -0.2772980332374573, -0.0102087333798409, -0.1117714717984200, -0.1674143821001053,
       -0.0040861475281417, 0.0677588805556297,  -0.2090093940496445, -0.0359521768987179, -0.0143001861870289,
       -0.0688551217317581, -0.0319875180721283, 0.0189111810177565,  0.0764310732483864,  0.0182978361845016,
       -0.1630418449640274, -0.0344807393848896, 0.1814004331827164,  0.1972102820873260,  -0.1867580413818359,
       0.1160594820976257,  0.1559566408395767,  -0.2745442688465118, 0.2158277779817581,  -0.1414507329463959,
       0.1514399647712708,  -0.0784491449594498, -0.0165825001895428, 0.0684599056839943,  0.2676224708557129,
       0.2342856973409653,  0.1473777294158936,  -0.1360305100679398, -0.1704669743776321, 0.0600620321929455,
       -0.2270322144031525, 0.2363941967487335,  -0.1034754142165184, 0.2107952833175659,  0.0613228380680084,
       -0.0656789392232895, -0.0706573277711868, -0.3130002319812775, -0.4511355757713318, 0.2614234983921051,
       -0.2002450376749039, -0.0332893878221512, 0.0650418028235435,  0.0183028094470501,  -0.2411361336708069,
       -0.4328272938728333, 0.0712450370192528,  -0.1775376647710800, 0.0232820920646191,  0.2361719012260437,
       0.1917583197355270,  0.2115956395864487,  -0.0614144168794155, -0.3047460317611694, 0.0191275011748075,
       0.2211048007011414,  -0.1066586375236511, 0.1717394292354584,  -0.1712522208690643, -0.2804011404514313,
       -0.1156273558735847, -0.2985107302665710, -0.1003591269254684, 0.1014007180929184,  0.0265407450497150,
       -0.0426047146320343, -0.0983200818300247, -0.2079924941062927, 0.0204964224249125,  -0.0546600669622421,
       0.0933992564678192,  -0.0859647840261459, 0.1670777201652527,  0.0334266759455204,  0.3186012506484985,
       0.0898096784949303,  -0.2379183173179626, 0.0825710445642471,  -0.0511870458722115, 0.0093247741460800,
       0.0906330719590187,  0.3379082977771759,  -0.1266515105962753, 0.3072393834590912,  0.1554922014474869,
       0.2072091847658157,  -0.1033450290560722, -0.1386580169200897, -0.0621290765702724, -0.0551605038344860,
       0.4241816699504852,  0.1438035666942596,  0.5108453631401062,  -0.0667321234941483, -0.0719717890024185,
       -0.2448850423097610, 0.7593796849250793,  -0.0069411233998835, -0.2107832133769989, 0.1869398057460785,
       0.2577454447746277,  0.3084534704685211,  -0.2231534123420715, -0.1153004765510559, 0.1584323197603226,
       0.3492555916309357,  0.5461788773536682,  0.0159522742033005,  0.1315079033374786,  0.3502896428108215,
       0.2018996030092239,  -0.0279236584901810, -0.0280409157276154, 0.0564647652208805,  -0.0666906759142876,
       -0.0560851246118546, 0.2417637556791306,  0.5166875720024109,  -0.0655641183257103, -0.1882169693708420,
       -0.1045480966567993, -0.1686654537916183, 0.0870803371071815,  0.4049435555934906,  -0.2672897577285767,
       0.0709417611360550,  0.1003862172365189,  0.0294550396502018,  0.1993283182382584,  0.0734266862273216,
       0.0451844669878483,  -0.1870880275964737, 0.0452349931001663,  -0.1434997618198395, -0.2961605489253998,
       0.0071269958280027,  0.1674074083566666,  -0.1879342347383499, -0.4411543607711792, -0.0949070528149605,
       0.2233230769634247,  0.1010906323790550,  -0.0355802550911903, 0.1662349402904510,  -0.0793796405196190,
       -0.3278736472129822, -0.0308303646743298, 0.1675858944654465,  0.1341154724359512,  -0.1124824956059456,
       0.1915174424648285,  -0.1161175221204758, 0.0656165406107903,  0.1795823872089386,  0.0003684223920573,
       -0.1991154998540878, -0.0304449852555990, -0.0900492519140244, 0.2377260476350784,  -0.2632785141468048,
       0.0306744817644358,  -0.0584713295102119, 0.1348943114280701,  0.1815990209579468,  0.0774008929729462,
       0.2164926975965500,  0.1835669577121735,  0.0261494684964418,  0.1228994801640511,  0.0920012965798378,
       0.2360248863697052,  0.2007864266633987,  0.1981531977653503,  -0.1720589846372604, -0.0518000461161137,
       0.1119798421859741,  -0.0908146128058434, -0.1652524024248123, -0.0489782243967056, -0.0721922963857651,
       0.0531321875751019,  0.3051426708698273,  -0.1490753889083862, -0.0489202775061131, -0.0497885905206203,
       0.0722440779209137,  0.0290557127445936,  0.4285544157028198,  -0.0308777391910553, 0.4812744259834290,
       -0.0088493963703513, 0.0636370703577995,  0.0336218774318695,  -0.3301452696323395, -0.0840113759040833,
       0.0155443605035543,  0.0374915562570095,  0.0185563880950212,  -0.0111947339028120, -0.2174694091081619,
       -0.0925301611423492, -0.0186573881655931, -0.0407128334045410, 0.0259345676749945,  0.0766611099243164,
       -0.0706957131624222, 0.4772287607192993,  0.2726272642612457,  0.0397118628025055,  0.1278085261583328,
       -0.3112552762031555, 0.0287287160754204,  -0.3010289669036865, 0.2505283951759338,  0.1073149666190147,
       0.0731914043426514,  0.1875303089618683,  -0.0765717923641205, -0.2192970067262650, -0.1028232425451279,
       0.0149964718148112,  -0.1033421233296394, -0.1785623133182526, 0.1790609657764435,  -0.1644740849733353,
       0.3069556951522827,  0.0419094488024712,  -0.0472408048808575, -0.1397754549980164, 0.0095161274075508,
       -0.1035561412572861, -0.0572677478194237, 0.0979338362812996,  -0.0655699893832207, 0.0110275112092495,
       -0.1702130287885666, 0.1627147942781448,  0.1533153057098389,  0.2531974315643311,  -0.1408938169479370,
       0.0038325397763401,  0.3882075548171997,  0.0160934198647738,  -0.0857189670205116, -0.0884034931659698,
       -0.1441510617733002, -0.0680643543601036, 0.3488612473011017,  0.2584056258201599,  -0.0296793095767498,
       -0.1646449863910675, -0.1250885576009750, 0.2888266742229462,  0.3705975711345673,  0.1041278764605522,
       0.0221802312880754,  0.2052762657403946,  -0.0202728062868118, -0.2200748771429062, -0.0023209974169731,
       0.1825831234455109,  0.0052341218106449,  0.0868081226944923,  -0.1853816658258438, -0.1588191390037537,
       -0.2136713862419128, 0.2423628270626068,  -0.3601258397102356, 0.3291118144989014,  -0.1596300750970840,
       0.0520132482051849,  0.2506307065486908,  0.3065473735332489,  0.0434803329408169,  0.0110460529103875,
       0.0991437509655952,  0.0828950554132462,  -0.0423594601452351, 0.0340315923094749,  0.0175018347799778,
       0.0128201767802238,  0.0237742010504007,  0.0308037102222443,  -0.1145193949341774, -0.1719782501459122,
       0.0119260139763355,  -0.1931618601083755, 0.1124162375926971,  -0.2521831095218658, 0.1694129705429077,
       0.3758922815322876,  0.0027186356019229,  -0.2133139222860336, -0.3327043056488037, -0.0768726915121078,
       -0.2487476319074631, 0.1133754551410675,  -0.1528486162424088, -0.2805321514606476, 0.3650567829608917,
       0.1011788547039032,  -0.1668319255113602, -0.0269413571804762, -0.0226848348975182, 0.3395069241523743,
       0.5830980539321899,  0.0012065854389220,  -0.1434152573347092, 0.2223355621099472,  -0.1286116540431976,
       -0.0965724289417267, -0.2262821197509766, -0.1763240993022919, 0.1794148683547974,  -0.4116857945919037,
       -0.0939919799566269, 0.0626904815435410,  0.0169370956718922,  -0.0040040519088507, 0.0814263522624969,
       0.0006241958471946,  0.1796548515558243,  -0.0913683474063873, 0.0055849687196314,  -0.1313805729150772,
       0.1081906706094742,  0.0429607257246971,  0.1620075851678848,  0.2291790544986725,  0.0510507859289646,
       0.1301191896200180,  -0.0493309944868088, 0.0369400456547737,  -0.0526916794478893, 0.0876538529992104,
       0.0815144032239914,  -0.1362349390983582, 0.1809250265359879,  -0.1369551271200180, -0.0182580463588238,
       0.1491440087556839,  -0.1945429146289825, -0.2256416976451874, 0.0551397129893303,  -0.0411634743213654,
       0.1677301079034805,  -0.1422920823097229, 0.0822139680385590,  -0.1520175039768219, 0.1658362299203873,
       -0.2913880944252014, -0.2470745742321014, -0.1105528622865677, -0.0952937453985214, -0.0173899251967669,
       0.3853271603584290,  -0.3223702907562256, -0.0234681293368340, -0.2829467654228210, -0.2032879739999771,
       -0.1596122384071350, 0.2926124930381775,  -0.3993989527225494, 0.0027687035035342,  -0.1368896663188934,
       0.0510595440864563,  0.2161986827850342,  -0.1772150546312332, -0.0074318242259324, -0.1298675686120987,
       0.0157614462077618,  -0.0674874037504196, -0.1724298894405365, -0.0613008290529251, -0.2706474959850311,
       -0.0857940316200256, -0.1389014571905136, -0.1029343307018280, 0.0305181331932545,  0.1527207642793655,
       0.0549057126045227,  -0.0864435806870461, -0.0179502256214619, 0.0598338954150677,  -0.0637406334280968,
       0.1224164515733719,  -0.1510628461837769, 0.0701517835259438,  0.0840567052364349,  -0.1333516389131546,
       0.0631716921925545,  0.0942254438996315,  -0.1921723037958145, -0.0930817723274231, 0.0467191897332668,
       0.0199973713606596,  -0.0667442530393600, -0.1858593970537186, 0.0720695331692696,  -0.2199677228927612,
       0.0374434143304825,  0.0005025093560107,  0.0074436669237912,  -0.0875650271773338, -0.3808604180812836,
       -0.2808012962341309, -0.0194517374038696, 0.1226817965507507,  0.2116415500640869,  0.0338676869869232,
       -0.2018589228391647, -0.1770412772893906, -0.2060951739549637, -0.2591722905635834, -0.0731093659996986,
       -0.4993058145046234, -0.1479619592428207, -0.0091711366549134, 0.4641340076923370,  -0.0668564960360527,
       0.0005178081919439,  0.3412970006465912,  0.3465945124626160,  -0.2328024655580521, 0.1929103136062622,
       -0.2491986900568008, 0.4219704866409302,  0.4160111844539642,  0.1302564740180969,  0.2074628621339798,
       -0.1295422464609146, 0.1477451622486115,  -0.2321954816579819, -0.6801446080207825, -0.0639185830950737,
       -0.0705380439758301, 0.3291463255882263,  0.3575600683689117,  -0.0797546952962875, -0.1928929239511490,
       -0.1917656213045120, 0.4558236598968506,  0.6994832754135132,  0.2251046597957611,  0.0185714978724718,
       0.0244300812482834,  -0.0394158884882927, 0.0567090250551701,  -0.0148310493677855, 0.0843826383352280,
       0.0088564986363053,  0.0429997518658638,  0.0840092450380325,  -0.1642618626356125, 0.0136057576164603,
       -0.0899279266595840, -0.0551396980881691, 0.1340543478727341,  -0.1764173060655594, -0.0302744675427675,
       -0.2664732933044434, 0.0456999503076077,  -0.0464947298169136, -0.0539095699787140, -0.1792884021997452,
       -0.0682860314846039, 0.1512248665094376,  0.0106913354247808,  -0.1218288168311119, 0.1490169018507004,
       0.0011426355922595,  0.0850447267293930,  -0.0138198044151068, -0.1361929178237915, 0.0211803112179041,
       -0.0549693964421749, -0.1639264374971390, 0.2993700504302979,  -0.1163950711488724, 0.6323078870773315,
       -0.0001297908311244, 0.3639669418334961,  -0.0531623736023903, 0.2456250488758087,  -0.6807768344879150,
       0.2828345596790314,  -0.8096221089363098, -0.0791671201586723, 0.4092252254486084,  0.7801607251167297,
       -0.0109603917226195, 0.0585485436022282,  -0.1985270678997040, 0.1836215108633041,  -0.0193555112928152,
       -0.0701978430151939, 0.0014120095875114,  0.0125588448718190,  0.1737328469753265,  0.1132446452975273,
       0.0087428679689765,  -0.0601917318999767, 0.5829847455024719,  0.0656698867678642,  0.0535521768033504,
       -0.0170098096132278, -0.0087991673499346, -0.2002796530723572, 0.1624161005020142,  0.2977543175220490,
       -0.2644388675689697, 0.1269486248493195,  0.1032761558890343,  -0.1338086873292923, -0.3096424043178558,
       0.3076373636722565,  -0.2369246184825897, 0.7131464481353760,  -0.3365736007690430, -0.4515317380428314,
       -0.0468767508864403, -0.4170203804969788, 0.0470391139388084,  -0.0243485067039728, -0.1485250741243362,
       -0.0880901589989662, 0.3889529109001160,  -0.1000121459364891, -0.4532140493392944, 0.1588893383741379,
       0.0495025850832462,  -0.1893077641725540, 0.0657719224691391,  -0.1662947684526443, 0.1115780994296074,
       -0.1642944663763046, 0.4386887848377228,  -0.1479124575853348, 0.5325345396995544,  0.3821423351764679,
       -0.1601736098527908, -0.1531294286251068, 0.0355741009116173,  0.3364476263523102,  -0.0945414230227470,
       0.1352884024381638,  0.0847275480628014,  -0.0853368788957596, -0.1016360595822334, -0.0561327300965786,
       0.2212703526020050,  -0.0368868857622147, 0.1371164917945862,  0.1625183373689651,  -0.3070071339607239,
       -0.2828620076179504, 0.1554674357175827,  0.2017966508865356,  -0.0946401730179787, -0.0229065362364054,
       0.0990885794162750,  -0.1256374269723892, 0.1361790597438812,  0.1127517670392990,  0.2969381809234619,
       0.0281653180718422,  -0.3557581007480621, -0.1776475757360458, -0.0400607734918594, 0.0037204551044852,
       -0.1177912577986717, -0.1303028017282486, -0.2717788517475128, 0.2582030594348907,  -0.0231986790895462,
       0.7424900531768799,  -0.0510946847498417, 0.3058365583419800,  0.0919316783547401,  0.1014426201581955,
       -0.0588330067694187, -0.1318739801645279, 0.1973321586847305,  -0.0562940165400505, 0.2910256087779999,
       -0.0741545855998993, -0.0601823404431343, -0.1839008331298828, 0.0608050599694252,  0.0140847861766815,
       -0.2109094113111496, -0.1040818020701408, 0.2850320637226105,  -0.2537658214569092, -0.1187311261892319,
       0.2772977650165558,  0.0056308349594474,  0.1867574006319046,  -0.1103472709655762, -0.1864063441753387,
       -0.1149483025074005, 0.2037804722785950,  -0.0296047758311033, 0.1443796455860138,  -0.0645545348525047,
       -0.2209509462118149, -0.0556764751672745, -0.4847581982612610, -0.0858014598488808, -0.1479284018278122,
       0.0808480679988861,  -0.1077153533697128, -0.0213508121669292, -0.1022880002856255, -0.0471015498042107,
       0.1184977367520332,  0.2296069413423538,  0.2945532798767090,  -0.2229489535093307, -0.2434960305690765,
       0.3599500954151154,  0.0814260020852089,  -0.0950683653354645, 0.0435146503150463,  0.0531829111278057,
       -0.1748648583889008, -0.0730416849255562, -0.0017271409742534, -0.0134304733946919, -0.1740276068449020,
       -0.2448696047067642, -0.0898879766464233, -0.1145503744482994, -0.0432672388851643, -0.1755324751138687,
       -0.0276873633265495, -0.1090683117508888, 0.0593755170702934,  -0.1600520163774490, 0.3674631118774414,
       -0.0661314502358437, -0.0458141639828682, 0.0294852200895548,  -0.2241058349609375, 0.1671825349330902,
       -0.0480570457875729, 0.1397646069526672,  0.1215760111808777,  0.0622984506189823,  0.3019196689128876,
       -0.0222269278019667, 0.0612430460751057,  -0.0617545098066330, 0.2752196490764618,  -0.0919468179345131,
       0.0966011136770248,  0.0638009011745453,  -0.1761289685964584, -0.1769258975982666, 0.0635361075401306,
       0.0047970768064260,  -0.1869851350784302, 0.1216230839490891,  0.0295011363923550,  -0.0703080892562866,
       0.1612739711999893,  -0.1825617700815201, 0.0598097369074821,  -0.1085373312234879, 0.0424414351582527,
       -0.0014793681912124, 0.0883003100752831,  -0.0575484186410904, -0.0206225384026766, 0.0483234561979771,
       0.0240854397416115,  -0.0245495084673166, -0.0112348766997457, 0.0679924339056015,  -0.0126954969018698,
       0.1498400717973709,  -0.0447169803082943, -0.1211568638682365, -0.1481154114007950, 0.0894937887787819,
       0.0774108394980431,  -0.0636242926120758, -0.0056351786479354, 0.1070617884397507,  -0.0905779823660851,
       0.0146339973434806,  -0.1398154199123383, 0.1239035576581955,  0.0558011457324028,  -0.0830512493848801,
       -0.0211245976388454, -0.0223468411713839, 0.0692412257194519,  0.0203148052096367,  0.0259597022086382,
       -0.0802891701459885, 0.0150794209912419,  -0.0970446094870567, 0.1408625543117523,  -0.0742703676223755,
       -0.1118937805294991, 0.0489897131919861,  -0.1301236897706985, 0.0959196016192436,  -0.0985299646854401,
       0.1082821041345596,  0.1182436123490334,  0.1396807730197906,  0.0896873250603676,  -0.0473667383193970,
       -0.1222399994730949, 0.1314424276351929,  0.0909981429576874,  -0.0903091207146645, 0.0555357933044434,
       0.0970507487654686,  -0.1711715459823608, -0.1112972125411034, 0.0329939797520638,  -0.0038172728382051,
       -0.0542287789285183, -0.1011091470718384, 0.0180572234094143,  -0.1009078025817871, 0.0856351703405380,
       -0.1452156901359558, 0.1467592567205429,  0.7698985934257507,  -0.4437164664268494, 0.1834065318107605,
       -0.6877657175064087, 0.3283969759941101,  -1.2533315420150757, -1.5543184280395508, 0.2810548245906830,
       -0.4696605205535889, 0.6806254982948303,  -0.7896854877471924, -0.9736716747283936, -2.0256879329681396,
       0.2646603882312775,  0.6460640430450439,  0.4181413054466248,  -0.4038503468036652, -1.3398544788360596,
       0.6849775314331055,  -0.0667094290256500, -1.2456604242324829, 1.1767007112503052,  0.3773677349090576,
       0.3844837844371796,  0.1859375983476639,  -0.9244448542594910, 2.7520096302032471,  0.5992047786712646,
       1.1844176054000854,  -0.9201347827911377, 0.7064630985260010,  -0.5716936588287354, 0.1469229161739349,
       0.0082814386114478,  0.1712782979011536,  -0.1510028690099716, 0.1147595196962357,  -0.3311481475830078,
       0.0033000251278281,  0.2953097820281982,  -0.3333314955234528, 0.1446689814329147,  0.0143496682867408,
       -0.3100873529911041, 0.2108983546495438,  -0.1182209253311157, 0.3265556097030640,  -0.1238258853554726,
       -0.1403052210807800, 0.1445630788803101,  0.1225338354706764,  0.0569081194698811,  -0.1735253334045410,
       0.1584508419036865,  0.1400195956230164,  0.1112674176692963,  -0.1774611473083496, 0.3973777890205383,
       0.0720169246196747,  -0.0387379489839077, 0.4983944594860077,  -0.1961547285318375, 0.4268509745597839,
       0.1833584606647491,  -0.0643411055207253, 0.0675244033336639,  0.0358794443309307,  0.1494037210941315,
       -0.0353793427348137, -0.1113656833767891, 0.0120755890384316,  0.0534861199557781,  0.0799377858638763,
       0.0371632240712643,  0.0909942016005516,  -0.0740175843238831, -0.2653962969779968, 0.1654711067676544,
       -0.0387528352439404, -0.0114778345450759, 0.0145211350172758,  0.0736028179526329,  -0.0372510813176632,
       -0.0076541737653315, 0.0671579837799072,  0.0172167066484690,  0.0253502260893583,  0.1095026955008507,
       0.2112608253955841,  0.0607584901154041,  -0.0053366534411907, 0.0435615628957748,  0.0531167164444923,
       0.0779128074645996,  0.1215642616152763,  -0.0333417579531670, 0.1581072211265564,  -0.1833543479442596,
       -0.0836108773946762, -0.3348965346813202, 0.0426676906645298,  -0.2049964219331741, -0.2244035154581070,
       0.0744991824030876,  0.1067514419555664,  0.2543023526668549,  -0.0059012286365032, 0.0083682769909501,
       -0.1863528192043304, 0.0309870410710573,  -0.0209806393831968, -0.0493911467492580, -0.1217262595891953,
       -0.0118316570296884, 0.1516335457563400,  0.1061316281557083,  -0.1325763314962387, 0.2032119482755661,
       0.0654937028884888,  0.1394991725683212,  -0.2014732211828232, 0.2717677652835846,  -0.0625881403684616,
       0.1341909766197205,  0.1967265605926514,  -0.1742424666881561, 0.0726436600089073,  -0.4418459832668304,
       -0.3516415953636169, 0.7117469310760498,  -0.6392387151718140, 0.3149298429489136,  -0.6181825399398804,
       0.1708630323410034,  -0.2927181422710419, 0.2909670770168304,  0.2058433741331100,  -0.7230219841003418,
       -0.7189653515815735, -0.1307742297649384, 0.1067659929394722,  -0.2598667144775391, -0.5600963234901428,
       -0.5074388384819031, 0.3733482658863068,  -0.3426586687564850, 0.3491403162479401,  0.1775495111942291,
       1.2998702526092529,  0.3782935142517090,  -0.2096965909004211, -0.5717831254005432, 0.1448981165885925,
       0.0793356895446777,  0.3646720051765442,  0.0426001995801926,  0.2050304561853409,  0.1553260684013367,
       -0.2915211915969849, -0.2908675968647003, 0.0911379531025887,  0.0509446635842323,  0.2698827683925629,
       -0.3328112661838531, -0.1368782520294189, 0.0514989532530308,  -0.0259670671075583, -0.1702766418457031,
       -0.0469807237386703, -0.2273506969213486, -0.1550466716289520, 0.1906624138355255,  0.0228409674018621,
       0.1464372426271439,  0.0052530081011355,  -0.0599816963076591, 0.1194543167948723,  0.1547756642103195,
       -0.0135046765208244, -0.1414916366338730, 0.0256914347410202,  0.0981358140707016,  0.1006882190704346,
       0.3603954911231995,  0.1368880420923233,  -0.0247711353003979, -0.1700445711612701, -0.0497309304773808,
       -0.2554778158664703, 0.1456004530191422,  -0.1097344383597374, -0.1983643919229507, 0.0550795085728168,
       -0.3345129787921906, 0.0859956517815590,  -0.1754550635814667, -0.3946107029914856, -0.0263938475400209,
       0.1160610094666481,  -0.0222772639244795, 0.0580102503299713,  -0.2486381083726883, 0.0826242119073868,
       0.1175407990813255};

// NOLINTNEXTLINE(bugprone-easily-swappable-parameters)
expression normalize_min_max_jb08(const expression &data, double min_val, double max_val)
{
    return (2_dbl * (data - min_val) / (max_val - min_val)) - 1_dbl;
}

expression rho_approximation_jb08(const expression &h, const std::vector<expression> &params)
{
    std::vector<expression> terms;
    terms.reserve(4);

    for (auto i = 0u; i < 4u; ++i) {
        terms.push_back(params[i] * exp(-(h - params[i + 8u]) * params[i + 4u]));
    }

    return sum(std::move(terms));
}

} // namespace

// This function returns the symbolic expressions of the thermospheric density at a certain geodetic coordinate, having
// the f107a, f107, ap indexes and from a time expression returning the days elapsed since the last 1st of January
// 00:00:00.
//
// NOTE: geodetic coordinates in the order [h, lat, lon].
// NOLINTNEXTLINE(bugprone-easily-swappable-parameters)
expression jb08_tn_impl(const std::vector<expression> &geodetic, const expression &f107, const expression &f107a,
                        const expression &s107, const expression &s107a,      // NOLINT
                        const expression &m107, const expression &m107a,      // NOLINT
                        const expression &y107, const expression &y107a,      // NOLINT
                        const expression &dDstdT, const expression &doy_expr) // NOLINT

{
    // Sanity checks.
    if (geodetic.size() != 3u) {
        throw std::invalid_argument("The geodetic argument value must have exactly the size 3");
    }

    // The expression for the number of (solar, not sidereal) rotations (rad.) made by the Earth since the last 1st of
    // January 00:00:00 UTC. (seconds in day)
    const expression sid = doy_expr * boost::math::constants::two_pi<double>();
    // The expression for the fraction of the orbit made by the Earth since the last 1st of January 00:00:00 UTC. (day
    // of year)
    const expression doy = doy_expr * (boost::math::constants::two_pi<double>() / 365.25);

    // Preparing the input expressions to the ffnn
    std::vector<expression> in;
    in.push_back(sin(geodetic[2])); // sin(lon)
    in.push_back(cos(geodetic[2])); // cos(lon)
    in.push_back(normalize_min_max_jb08(geodetic[1], -boost::math::constants::half_pi<double>(),
                                        boost::math::constants::half_pi<double>())); // geodetic latitude
    in.push_back(sin(sid));
    in.push_back(cos(sid));
    in.push_back(sin(doy));
    in.push_back(cos(doy));
    in.push_back(normalize_min_max_jb08(f107, 60.0, 266.0));
    in.push_back(normalize_min_max_jb08(f107a, 60.0, 170.0));
    in.push_back(normalize_min_max_jb08(s107, 50.0, 190.0));
    in.push_back(normalize_min_max_jb08(s107a, 50.0, 170.0));
    in.push_back(normalize_min_max_jb08(m107, 50.0, 190.0));
    in.push_back(normalize_min_max_jb08(m107a, 50.0, 160.0));
    in.push_back(normalize_min_max_jb08(y107, 50.0, 180.0));
    in.push_back(normalize_min_max_jb08(y107a, 50.0, 170.0));
    in.push_back(normalize_min_max_jb08(dDstdT, 0.0, 390.0));

    // Instantiating the ffnn
    std::vector<expression> delta_params = ffnn(kw::inputs = in, kw::nn_hidden = {32, 32}, kw::n_out = 12,
                                                kw::activations = {tanh, tanh, tanh}, kw::nn_wb = flattened_nw);

    // We create an alias as to reflect the semantic change of the values stored by the variable that the for loop will
    // introduce.
    auto &params = delta_params;
    for (decltype(delta_params.size()) i = 0; i < delta_params.size(); ++i) {
        params[i] = (best_global_fit[i] * (1_dbl + delta_params[i]));
    }

    expression retval = rho_approximation_jb08(geodetic[0], params);
    return retval;
}

} // namespace model::detail

HEYOKA_END_NAMESPACE
