
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Benchmarks &#8212; heyoka 6.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=32485e33"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'benchmarks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notes on automatic differentiation" href="ad_notes.html" />
    <link rel="prev" title="Compiled functions" href="cfunc.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/white_logo.png" class="logo__image only-light" alt="heyoka 6.0.0 documentation - Home"/>
    <script>document.write(`<img src="_static/white_logo.png" class="logo__image only-dark" alt="heyoka 6.0.0 documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="basic_tutorials.html">Basic tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tut_taylor_method.html">Taylorâ€™s method</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_expression_system.html">The expression system</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_adaptive.html">The adaptive integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_adaptive_custom.html">Customising the adaptive integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_param.html">Runtime parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_nonauto.html">Non-autonomous systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_d_output.html">Dense &amp; continuous output</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_events.html">Event detection</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="advanced_tutorials.html">Advanced tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tut_batch_mode.html">Batch mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_extended_precision.html">Computations in extended precision</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_arbitrary_precision.html">Computations in arbitrary precision</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_single_precision.html">Computations in single precision</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_s11n.html">Serialisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_ensemble.html">Ensemble propagations</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_parallel_mode.html">Parallel mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_cfunc.html">Compiled functions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api_reference.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="definitions.html">Macros and definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="kwargs.html">Keyword arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="mdspan.html">Multidimensional array views</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="expression_system.html">Expression system</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="variable.html">Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="number.html">Numerical constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="param.html">Runtime parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="func.html">N-ary functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="expression.html">Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="math.html">Mathematical functions</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="cfunc.html">Compiled functions</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="ad_notes.html">Notes on automatic differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="breaking_changes.html">Breaking changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known issues</a></li>


<li class="toctree-l1"><a class="reference internal" href="acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/bluescarni/heyoka" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bluescarni/heyoka/issues/new?title=Issue%20on%20page%20%2Fbenchmarks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/benchmarks.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Benchmarks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-planetary-three-body-problem">The planetary three-body problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-outer-solar-system">The outer Solar System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#event-detection">Event detection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-forth">Back &amp; forth</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extended-and-arbitrary-precision">Extended and arbitrary precision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dense-output-fidelity-and-stability">Dense output fidelity and stability</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="benchmarks">
<span id="id1"></span><h1>Benchmarks<a class="headerlink" href="#benchmarks" title="Link to this heading">#</a></h1>
<p>In this section we provide a few performance comparisons between heyoka and other popular
ODE integration packages. Specifically, we compare heyoka to:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://diffeq.sciml.ai/">DifferentialEquations.jl</a>, a popular Julia
library implementing several ODE solvers. In these benchmarks, we will be using
explicit Runge-Kutta solvers such as <code class="docutils literal notranslate"><span class="pre">Vern6</span></code>, <code class="docutils literal notranslate"><span class="pre">Vern8</span></code>, <code class="docutils literal notranslate"><span class="pre">Vern9</span></code>, <code class="docutils literal notranslate"><span class="pre">Feagin14</span></code>, <code class="docutils literal notranslate"><span class="pre">DP8</span></code>, etc. (see
<a class="reference external" href="https://diffeq.sciml.ai/stable/solvers/ode_solve/">here</a> for a list of
ODE solvers available in DifferentialEquations.jl);</p></li>
<li><p><a class="reference external" href="https://www.boost.org/doc/libs/master/libs/numeric/odeint/doc/html/index.html">Boost.ODEInt</a>,
a C++ package implementing various algorithms for the solution of systems of ODEs. In these
benchmarks, we will be using the explicit Runge-Kutta-Fehlberg 78 solver;</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> integrator from <a class="reference external" href="https://github.com/hannorein/rebound">REBOUND</a>,
a popular N-body integration package. Like heyoka, <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> is a high-precision
non-symplectic integrator with adaptive timestepping capable of conserving the
dynamical invariants over billions of dynamical timescales.</p></li>
</ul>
<p>Note that the integrators from DifferentialEquations.jl by default
enable dense output, which however incurs in a heavy computational cost. While heyoka also supports
<a class="reference internal" href="tut_d_output.html#tut-d-output"><span class="std std-ref">dense output</span></a>, this feature is opt-in and its performance impact is much more limited.
In these benchmarks, we will be testing both with and without dense output.</p>
<p>All benchmarks were run on an Intel Xeon Platinum 8360Y CPU. More benchmark results are available in the
<a class="reference external" href="https://arxiv.org/abs/2105.00800">heyoka paper</a>.
The benchmarksâ€™ source code (for both heyoka and the other tested libraries)
is available in the <a class="reference external" href="https://github.com/bluescarni/heyoka/tree/master/benchmark">github repository</a>.</p>
<section id="the-planetary-three-body-problem">
<h2>The planetary three-body problem<a class="headerlink" href="#the-planetary-three-body-problem" title="Link to this heading">#</a></h2>
<p>Here we will numerically integrate a specific case of the <a class="reference external" href="https://en.wikipedia.org/wiki/Three-body_problem">three-body problem</a>
in which the three particles are the Sun, Jupiter and Saturn, all represented as point masses
attracting each other according to <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_law_of_universal_gravitation">Newtonian gravity</a>.
The initial conditions are taken from <a class="reference external" href="https://ntrs.nasa.gov/citations/19860060859">this paper</a>, and the integration
is run for a total of <span class="math notranslate nohighlight">\(10^5\)</span> years.
For the DifferentialEquations.jl integrators and heyoka, the test is run both with and without <a class="reference internal" href="tut_d_output.html#tut-d-output"><span class="std std-ref">dense output</span></a>. When dense output is enabled,
the result of the integration over <span class="math notranslate nohighlight">\(5 \times 10^5\)</span> equispaced time grid points is requested.</p>
<p>In order to measure the accuracy of the integration, we will also compare the final state of the system
with the result of a numerical integration in quadruple precision with a tolerance of <span class="math notranslate nohighlight">\(10^{-30}\)</span>.</p>
<p>Let us see first the results for an error tolerance of <span class="math notranslate nohighlight">\(10^{-15}\)</span>:</p>
<img alt="3BP benchmark 1e-15" class="align-center" src="_images/ss_3bp_15.png" />
<p>We can see how, without dense output, heyoka is at least 3 times faster than any other tested integrator. When dense output is requested (gray bars),
heyokaâ€™s runtime increases by <span class="math notranslate nohighlight">\(\sim 50\%\)</span>, whereas for the other integrators the performance hit is substantially larger. Performance-wise,
Boost.ODEint is comparable to <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> (note that the <code class="docutils literal notranslate"><span class="pre">RKF78</span></code> integrator from Boost.ODEInt does not support dense output).</p>
<p>From the point of view of the integration accuracy, we can see how heyoka has the lowest relative error (with respect to the quadruple-precision integration)
among the tested integrators.</p>
<p>Note that, even if the error tolerance for the integration is set to <span class="math notranslate nohighlight">\(10^{-15}\)</span>, the error at the end of the integration
is of the order of <span class="math notranslate nohighlight">\(10^{-9}\)</span>. This is to be expected, as the error on the state variables accumulates as (at least)
<span class="math notranslate nohighlight">\(t^{\frac{3}{2}}\)</span> (a result known as Brouwerâ€™s law).</p>
<p>Let us now see the results for an error tolerance of <span class="math notranslate nohighlight">\(10^{-9}\)</span>:</p>
<img alt="3BP benchmark 1e-9" class="align-center" src="_images/ss_3bp_9.png" />
<p>Whereas heyoka is still faster than the other integrators, at this higher integration tolerance the performance
advantage is smaller.</p>
<p>The integration accuracy of both heyoka and <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> is of the order of <span class="math notranslate nohighlight">\(10^{-3}\)</span>. The other integrators feature
a much worse accuracy.</p>
<p>Finally, let us see the results for an error tolerance of <span class="math notranslate nohighlight">\(10^{-6}\)</span>. In this test, we will replace <code class="docutils literal notranslate"><span class="pre">Feagin14</span></code>
with <code class="docutils literal notranslate"><span class="pre">Vern6</span></code>, which is supposed to be more efficient at high tolerances:</p>
<img alt="3BP benchmark 1e-6" class="align-center" src="_images/ss_3bp_6.png" />
<p>At low accuracy, heyoka performs similarly to <code class="docutils literal notranslate"><span class="pre">DP8</span></code> and <code class="docutils literal notranslate"><span class="pre">RKF78</span></code> without dense output. When dense output is requested,
heyoka retains a substantial performance advantage.</p>
</section>
<section id="the-outer-solar-system">
<h2>The outer Solar System<a class="headerlink" href="#the-outer-solar-system" title="Link to this heading">#</a></h2>
<p>In this benchmark, we will integrate the motion of the outer Solar System for 1 million years. We define the outer Solar
System as the 6-body problem consisting of the Sun, Jupiter, Saturn, Uranus, Neptune and Pluto, all considered as point
masses attracting each other according to <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_law_of_universal_gravitation">Newtonian gravity</a>.
The initial conditions are taken from <a class="reference external" href="https://ntrs.nasa.gov/citations/19860060859">this paper</a>.</p>
<p>For this benchmark, we will be comparing heyoka to the <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> integrator from <a class="reference external" href="https://github.com/hannorein/rebound">REBOUND</a>.</p>
<p>Here are the results:</p>
<a class="reference internal image-reference" href="_images/outer_ss_bench.png"><img alt="Outer Solar System benchmark" class="align-center" src="_images/outer_ss_bench.png" style="width: 576.0px; height: 360.0px;" />
</a>
<p>We can see how heyoka is about 5 times faster than <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> in this specific test. A detailed performance comparison with <code class="docutils literal notranslate"><span class="pre">IAS15</span></code>
is available in the <a class="reference external" href="https://arxiv.org/abs/2105.00800">heyoka paper</a>.</p>
</section>
<section id="event-detection">
<h2>Event detection<a class="headerlink" href="#event-detection" title="Link to this heading">#</a></h2>
<p>In this benchmark we measure the overhead of heyokaâ€™s <a class="reference internal" href="tut_events.html#tut-events"><span class="std std-ref">event detection</span></a> system and compare it to
the <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> and <code class="docutils literal notranslate"><span class="pre">DP8</span></code> integrators from DifferentialEquations.jl.
We consider the dynamical system studied by HÃ©non and Heiles in a
<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/1964AJ.....69...73H/abstract">famous numerical experiment</a> investigating
the existence of additional integrals of motion in axisymmetric potentials. The differential equations are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
v_x^\prime &amp;= -x-2xy \\
v_y^\prime &amp;= y^2-y-x^2 \\
x^\prime &amp;= v_x \\
y^\prime &amp;= v_y
\end{cases},\end{split}\]</div>
<p>with initial conditions</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
v_x\left(0\right) &amp;= -0.2525875586263492  \\
v_y\left(0\right) &amp;= -0.2178423952983717  \\
x\left(0\right) &amp;= 0  \\
y\left(0\right) &amp;=  0.2587703282931232 \\
\end{cases}.\end{split}\]</div>
<p>Our objective is to compute the <a class="reference external" href="https://en.wikipedia.org/wiki/Poincar%C3%A9_map">PoincarÃ© section</a>
of the solution on the <span class="math notranslate nohighlight">\(\left( y,v_y \right)\)</span> plane. This can be accomplished by setting up the event equation</p>
<div class="math notranslate nohighlight">
\[x = 0\]</div>
<p>to detect when the solution crosses the <span class="math notranslate nohighlight">\(\left( y,v_y \right)\)</span> plane. Like in the original paper,
we impose the additional constraint that the event direction must be <em>positive</em> (i.e., we only detect
crossing of the plane from below). The total integration time is <span class="math notranslate nohighlight">\(2000\)</span> time units and the tolerance
is set to <span class="math notranslate nohighlight">\(10^{-15}\)</span>. For both heyoka and the DifferentialEquations.jl integrators, we measure the runtime
both with and without event detection.</p>
<p>Here are the results:</p>
<img alt="Event detection benchmark" class="align-center" src="_images/event_det.png" />
<p>We can see how heyokaâ€™s event detection system has a much lower overhead than the event detection system in
DifferentialEquations.jl. heyokaâ€™s event detection system combines the free dense output from Taylorâ€™s method
with state-of-the-art polynomial root finding techniques to provide an event-detection methodology which is
both rigorous and computationally efficient. By contrast, DifferentialEquations.jl adopts the approach
of checking for sign changes in the event equation using the interpolant of the solution
within a timestep at discrete points. Note that
this approach is not rigorous, in the sense that if the event equation has two zeroes between the interpolation
points the event will be missed. By contrast, heyokaâ€™s approach does not suffer from this issue.</p>
</section>
<section id="back-forth">
<h2>Back &amp; forth<a class="headerlink" href="#back-forth" title="Link to this heading">#</a></h2>
<p>In this benchmark, we will first integrate an ODE system forward in time from
<span class="math notranslate nohighlight">\(t_0\)</span> to <span class="math notranslate nohighlight">\(t_1\)</span>. We will then invert the time direction to return back
to the initial time <span class="math notranslate nohighlight">\(t_0\)</span>. The state vector at the end of this process
should closely match the initial conditions.</p>
<p>In order to keep things simple, we will be using the equations of the simple pendulum in SI units,
and we choose <span class="math notranslate nohighlight">\(t_0 = 0\,\mathrm{s}\)</span> and <span class="math notranslate nohighlight">\(t_1 = 1000\,\mathrm{s}\)</span>. Our goal is to
quantify the integration error, measured as the magnitude of the difference between the initial conditions
and the state vector at the end of the integration. Let us see the results for heyoka,
<code class="docutils literal notranslate"><span class="pre">Vern9</span></code> from DifferentialEquations.jl and the <code class="docutils literal notranslate"><span class="pre">RKF78</span></code> integrator from Boost.ODEInt:</p>
<img alt="Back and forth benchmark" class="align-center" src="_images/bandf.png" />
<p>We can see how heyoka is able to return to the initial conditions much more accurately than the other
two integrators.</p>
<p>heyokaâ€™s superior accuracy in this test is due in large part to the fact that heyoka adopts internally an extended
precision representation for the time coordinate based on
<a class="reference external" href="https://en.wikipedia.org/wiki/Quadruple-precision_floating-point_format#Double-double_arithmetic">double-length arithmetic</a>.
This approach allows to drastically reduce the loss of precision occurring when
the time coordinate is updated at the end of a timestep:
while the time coordinate grows larger throughout the integration,
the (adaptive) step size remains roughly constant in magnitude, thus resulting
in a gradual accumulation of roundoff error.
Representing the time coordinate in extended precision allows to drastically
curb this phenomenon, which is particularly visible in long-running numerical integrations.</p>
</section>
<section id="extended-and-arbitrary-precision">
<h2>Extended and arbitrary precision<a class="headerlink" href="#extended-and-arbitrary-precision" title="Link to this heading">#</a></h2>
<p>heyoka supports computations both in <a class="reference internal" href="tut_extended_precision.html#tut-extended-precision"><span class="std std-ref">extended precision</span></a> and
<a class="reference internal" href="tut_arbitrary_precision.html#tut-arbitrary-precision"><span class="std std-ref">arbitrary precision</span></a>. Taylor integrators are particularly
well-suited for high-precision applications because they can freely choose the optimal
order for a given tolerance. In contrast, fixed-order methods must reduce the integration
timestep in order to achieve higher accuracy, which is more computationally expensive
than increasing the integratorâ€™s order.</p>
<p>In this first test, we perform a numerical integration of the simple pendulum using
<a class="reference external" href="https://en.wikipedia.org/wiki/Quadruple-precision_floating-point_format">quadruple-precision</a>
arithmetic, with a tolerance set to <span class="math notranslate nohighlight">\(10^{-34}\)</span> (i.e., close to the epsilon). heyokaâ€™s
runtime is compared to the runtime of the <code class="docutils literal notranslate"><span class="pre">Feagin14</span></code> from <a class="reference external" href="https://diffeq.sciml.ai/">DifferentialEquations.jl</a>.
Both libraries are using the <a class="reference external" href="https://gcc.gnu.org/onlinedocs/libquadmath/">quadruple-precision math library</a>
from GCC under the hood.</p>
<img alt="Quadruple-precision pendulum" class="align-center" src="_images/quad_cmp.png" />
<p>We can see how in this test heyoka is about 20 times faster than <code class="docutils literal notranslate"><span class="pre">Feagin14</span></code>.</p>
<p>We can move to even higher precisions with the help of
<a class="reference external" href="https://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic">arbitrary-precision arithmetic</a>.
heyoka uses the <a class="reference external" href="https://www.mpfr.org/">MPFR library</a> for multiprecision floating-point
computations under the hood. DifferentialEquations.jl can also use MPFR (via the
<a class="reference external" href="https://docs.julialang.org/en/v1/manual/integers-and-floating-point-numbers/#Arbitrary-Precision-Arithmetic">BigFloat</a>
type) or, alternatively the <a class="reference external" href="https://arblib.org/">Arb</a> library (via the
<a class="reference external" href="https://github.com/JeffreySarnoff/ArbNumerics.jl">ArbNumerics.jl</a> package).</p>
<p>Here are the results of a numerical integration of the simple pendulum with a 256-bit significand
and a tolerance of <span class="math notranslate nohighlight">\(10^{-77}\)</span>:</p>
<img alt="Arbitrary-precision pendulum" class="align-center" src="_images/mp_cmp.png" />
<p>We can see how heyokaâ€™s performance lead has extended to several orders of magnitude.</p>
<p>heyokaâ€™s superior performance in this benchmark is due both to the algorithmic advantages
of Taylor integrators (as discussed earlier) and to the fact that heyokaâ€™s stepper function
does not perform any memory allocation. That is, contrary to the Julia integrators,
the storage for all the multiprecision numbers employed in the stepper function is
pre-allocated on the stack, rather than being dynamically-allocated on-demand for every
multiprecision operation.</p>
</section>
<section id="dense-output-fidelity-and-stability">
<h2>Dense output fidelity and stability<a class="headerlink" href="#dense-output-fidelity-and-stability" title="Link to this heading">#</a></h2>
<p>As explained in the <a class="reference internal" href="tut_d_output.html#tut-d-output"><span class="std std-ref">dense output tutorial</span></a>, Taylor integrators
provide dense output (almost) for free in the form of the coefficients of the Taylor
series of the solution of the ODE. By contrast, in most other integration methods
(such as the Runge-Kutta family) dense output is computed via polynomial
interpolation.</p>
<p>Polynomial interpolation can sometimes suffer from numerical instability,
especially in high-accuracy applications. In this test, we are integrating
a simple Keplerian circular orbit with tolerance <span class="math notranslate nohighlight">\(10^{-12}\)</span>, and asking
the numerical integrator for the dense output in a time grid of 1000 equispaced
points within the <span class="math notranslate nohighlight">\(\left[0, 1\right]\)</span> time interval. This plot
shows the integration error (computed against the analytical solution)
for heyoka and the <code class="docutils literal notranslate"><span class="pre">Vern8</span></code> integrator from <a class="reference external" href="https://diffeq.sciml.ai/">DifferentialEquations.jl</a>
(an explicit Runge-Kutta method with lazy 8th order interpolant):</p>
<img alt="Dense output for a circular orbit" class="align-center" src="_images/dense_cmp.png" />
<p>We can see how for <code class="docutils literal notranslate"><span class="pre">Vern8</span></code> the dense output between the integration steps
suffers from a noisy error that often exceeds the nominal tolerance of <span class="math notranslate nohighlight">\(10^{-12}\)</span>, peaking
to a local maximum right at the end of each integration step. This phenomenon
disappears when switching to a higher-precision datatype, strongly suggesting that the
behaviour is caused by numerical instability. The noisy and jittery behaviour of the dense
output can be problematic when trying to solve inversion problems in high-accuracy setups
(e.g., in precise orbit modelling/determination).</p>
<p>heyokaâ€™s dense output, by contrast, has an error bounded well below the nominal tolerance of <span class="math notranslate nohighlight">\(10^{-12}\)</span>,
and it does not suffer from the noisy behaviour experienced by <code class="docutils literal notranslate"><span class="pre">Vern8</span></code>. Indeed, in Taylor integrators,
the dense output is calculated directly from the same formula (i.e., the Taylor series)
used to compute the state at the end of the timestep, and it is thus guaranteed to be consistent
with the state of the system at the beginning/end of the timesteps.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="cfunc.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Compiled functions</p>
      </div>
    </a>
    <a class="right-next"
       href="ad_notes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notes on automatic differentiation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-planetary-three-body-problem">The planetary three-body problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-outer-solar-system">The outer Solar System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#event-detection">Event detection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-forth">Back &amp; forth</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extended-and-arbitrary-precision">Extended and arbitrary precision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dense-output-fidelity-and-stability">Dense output fidelity and stability</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Francesco Biscani, Dario Izzo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2020, 2021, 2022, 2023, 2024 Francesco Biscani, Dario Izzo.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>