
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Benchmarks &#8212; heyoka 0.17.0 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notes on automatic differentiation" href="ad_notes.html" />
    <link rel="prev" title="Ensemble propagations" href="tut_ensemble.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/white_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">heyoka 0.17.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="basic_tutorials.html">
   Basic tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_taylor_method.html">
     Taylor’s method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_expression_system.html">
     The expression system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_adaptive.html">
     The adaptive integrator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_adaptive_custom.html">
     Customising the adaptive integrator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_param.html">
     Runtime parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_nonauto.html">
     Non-autonomous systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_d_output.html">
     Dense &amp; continuous output
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_events.html">
     Event detection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="advanced_tutorials.html">
   Advanced tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_batch_mode.html">
     Batch mode
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_s11n.html">
     Serialisation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tut_ensemble.html">
     Ensemble propagations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Benchmarks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ad_notes.html">
   Notes on automatic differentiation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="breaking_changes.html">
   Breaking changes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="acknowledgement.html">
   Acknowledgement
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/benchmarks.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/bluescarni/heyoka"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/bluescarni/heyoka/issues/new?title=Issue%20on%20page%20%2Fbenchmarks.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-planetary-three-body-problem">
   The planetary three-body problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-outer-solar-system">
   The outer Solar System
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#event-detection">
   Event detection
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Benchmarks</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-planetary-three-body-problem">
   The planetary three-body problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-outer-solar-system">
   The outer Solar System
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#event-detection">
   Event detection
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="benchmarks">
<span id="id1"></span><h1>Benchmarks<a class="headerlink" href="#benchmarks" title="Permalink to this headline">¶</a></h1>
<p>In this section we provide a few performance comparisons between heyoka and other popular
ODE integration packages. Specifically, we compare heyoka to:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://diffeq.sciml.ai/">DifferentialEquations.jl</a>, a popular Julia
library implementing several ODE solvers. In these benchmarks, we will be using
explicit Runge-Kutta solvers such as <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> and <code class="docutils literal notranslate"><span class="pre">DP8</span></code> (see
<a class="reference external" href="https://diffeq.sciml.ai/stable/solvers/ode_solve/">here</a> for a list of
ODE solvers available in DifferentialEquations.jl);</p></li>
<li><p><a class="reference external" href="https://www.boost.org/doc/libs/master/libs/numeric/odeint/doc/html/index.html">Boost.ODEInt</a>,
a C++ package implementing various algorithms for the solution of systems of ODEs. In these
benchmarks, we will be using the explicit Runge-Kutta-Fehlberg 78 solver;</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> integrator from <a class="reference external" href="https://github.com/hannorein/rebound">REBOUND</a>,
a popular N-body integration package. Like heyoka, <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> is a high-precision
non-symplectic integrator with adaptive timestepping capable of conserving the
dynamical invariants over billions of dynamical timescales. Note, however, that
<code class="docutils literal notranslate"><span class="pre">IAS15</span></code> is not a general-purpose integrator, and thus we will be able to use
it only in benchmarks involving gravitational N-body systems.</p></li>
</ul>
<p>Note that the integrators from DifferentialEquations.jl by default
enable dense output, which however incurs in a heavy computational cost. While heyoka also supports
<a class="reference internal" href="tut_d_output.html#tut-d-output"><span class="std std-ref">dense output</span></a>, this feature is opt-in and its performance impact is much more limited.
In these benchmarks, we will be testing both with and without dense output.</p>
<p>All benchmarks were run on an Intel Xeon Platinum 8360Y CPU. More benchmark results are available in the
<a class="reference external" href="https://arxiv.org/abs/2105.00800">heyoka paper</a>.
The benchmarks’ source code is available in the <a class="reference external" href="https://github.com/bluescarni/heyoka/tree/master/benchmark">github repository</a>.</p>
<div class="section" id="the-planetary-three-body-problem">
<h2>The planetary three-body problem<a class="headerlink" href="#the-planetary-three-body-problem" title="Permalink to this headline">¶</a></h2>
<p>Here we will numerically integrate a specific case of the <a class="reference external" href="https://en.wikipedia.org/wiki/Three-body_problem">three-body problem</a>
in which the three particles are the Sun, Jupiter and Saturn, all represented as point masses
attracting each other according to <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_law_of_universal_gravitation">Newtonian gravity</a>.
The initial conditions are taken from <a class="reference external" href="https://ntrs.nasa.gov/citations/19860060859">this paper</a>, and the integration
is run for a total of <span class="math notranslate nohighlight">\(10^5\)</span> years.
For <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> and heyoka, the test is run both with and without <a class="reference internal" href="tut_d_output.html#tut-d-output"><span class="std std-ref">dense output</span></a>. When dense output is enabled,
the result of the integration over <span class="math notranslate nohighlight">\(5 \times 10^5\)</span> equispaced time grid points is requested.</p>
<p>In order to measure the accuracy of the integration, we will also compare the final state of the system
with the result of a numerical integration in quadruple precision with a tolerance of <span class="math notranslate nohighlight">\(10^{-30}\)</span>.</p>
<p>Let us see first the results for an error tolerance of <span class="math notranslate nohighlight">\(10^{-15}\)</span>:</p>
<img alt="3BP benchmark 1e-15" class="align-center" src="_images/ss_3bp_15.png" />
<p>We can see how, without dense output, heyoka is about 3 times faster than <code class="docutils literal notranslate"><span class="pre">Vern9</span></code>. When dense output is requested,
heyoka’s runtime increases by a modest <span class="math notranslate nohighlight">\(\sim 24\%\)</span>, whereas for <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> the runtime increases by a factor of
<span class="math notranslate nohighlight">\(\sim 3\)</span>, so that, with dense output, heyoka is about <span class="math notranslate nohighlight">\(\sim 7\)</span> times faster than <code class="docutils literal notranslate"><span class="pre">Vern9</span></code>. Performance-wise,
Boost.ODEint is comparable to <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> (note that the RKF78 integrator from Boost.ODEInt does not support dense output).</p>
<p>From the point of view of the integration accuracy, we can see how the RMS of the error across the components of the state
vector with respect to the quadruple-precision integration is of the order of <span class="math notranslate nohighlight">\(10^{-9}\)</span> for heyoka, while for both
<code class="docutils literal notranslate"><span class="pre">Vern9</span></code> and Boost.ODEInt the error is about <span class="math notranslate nohighlight">\(\sim 35\)</span> times larger.</p>
<p>Note that, even if the error tolerance for the integration is set to <span class="math notranslate nohighlight">\(10^{-15}\)</span>, the error at the end of the integration
is of the order of <span class="math notranslate nohighlight">\(10^{-9}\)</span>. This is to be expected, as the error on the state variables accumulates as (at least)
<span class="math notranslate nohighlight">\(t^{\frac{3}{2}}\)</span> (a result known as Brouwer’s law).</p>
<p>Let us now see the results for an error tolerance of <span class="math notranslate nohighlight">\(10^{-9}\)</span>:</p>
<img alt="3BP benchmark 1e-9" class="align-center" src="_images/ss_3bp_9.png" />
<p>Whereas heyoka is still faster than <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> and Boost.ODEInt, at this higher integration tolerance the performance
advantage is smaller.</p>
<p>The integration accuracy of both heyoka and <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> is of the order of <span class="math notranslate nohighlight">\(10^{-3}\)</span>. By contrast,
the accuracy of Boost.ODEInt is two orders of magnitude worse.</p>
</div>
<div class="section" id="the-outer-solar-system">
<h2>The outer Solar System<a class="headerlink" href="#the-outer-solar-system" title="Permalink to this headline">¶</a></h2>
<p>In this benchmark, we will integrate the motion of the outer Solar System for 1 million years. We define the outer Solar
System as the 6-body problem consisting of the Sun, Jupiter, Saturn, Uranus, Neptune and Pluto, all considered as point
masses attracting each other according to <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_law_of_universal_gravitation">Newtonian gravity</a>.
The initial conditions are taken from <a class="reference external" href="https://ntrs.nasa.gov/citations/19860060859">this paper</a>.</p>
<p>For this benchmark, we will be comparing heyoka to the <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> integrator from <a class="reference external" href="https://github.com/hannorein/rebound">REBOUND</a>.</p>
<p>Here are the results:</p>
<a class="reference internal image-reference" href="_images/outer_ss_bench.png"><img alt="Outer Solar System benchmark" class="align-center" src="_images/outer_ss_bench.png" style="width: 576.0px; height: 360.0px;" /></a>
<p>We can see how heyoka is about 5 times faster than <code class="docutils literal notranslate"><span class="pre">IAS15</span></code> in this specific test. A detailed performance comparison with <code class="docutils literal notranslate"><span class="pre">IAS15</span></code>
is available in the <a class="reference external" href="https://arxiv.org/abs/2105.00800">heyoka paper</a>.</p>
</div>
<div class="section" id="event-detection">
<h2>Event detection<a class="headerlink" href="#event-detection" title="Permalink to this headline">¶</a></h2>
<p>In this benchmark we measure the overhead of heyoka’s <a class="reference internal" href="tut_events.html#tut-events"><span class="std std-ref">event detection</span></a> system and compare it to
the <code class="docutils literal notranslate"><span class="pre">Vern9</span></code> and <code class="docutils literal notranslate"><span class="pre">DP8</span></code> integrators from DifferentialEquations.jl.
We consider the dynamical system studied by Hénon and Heiles in a
<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/1964AJ.....69...73H/abstract">famous numerical experiment</a> investigating
the existence of additional integrals of motion in axisymmetric potentials. The differential equations are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
v_x^\prime &amp;= -x-2xy \\
v_y^\prime &amp;= y^2-y-x^2 \\
x^\prime &amp;= v_x \\
y^\prime &amp;= v_y
\end{cases},\end{split}\]</div>
<p>with initial conditions</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
v_x\left(0\right) &amp;= -0.2525875586263492  \\
v_y\left(0\right) &amp;= -0.2178423952983717  \\
x\left(0\right) &amp;= 0  \\
y\left(0\right) &amp;=  0.2587703282931232 \\
\end{cases}.\end{split}\]</div>
<p>Our objective is to compute the <a class="reference external" href="https://en.wikipedia.org/wiki/Poincar%C3%A9_map">Poincaré section</a>
of the solution on the <span class="math notranslate nohighlight">\(\left( y,v_y \right)\)</span> plane. This can be accomplished by setting up the event equation</p>
<div class="math notranslate nohighlight">
\[x = 0\]</div>
<p>to detect when the solution crosses the <span class="math notranslate nohighlight">\(\left( y,v_y \right)\)</span> plane. Like in the original paper,
we impose the additional constraint that the event direction must be <em>positive</em> (i.e., we only detect
crossing of the plane from below). The total integration time is <span class="math notranslate nohighlight">\(2000\)</span> time units and the tolerance
is set to <span class="math notranslate nohighlight">\(10^{-15}\)</span>. For both heyoka and the DifferentialEquations.jl integrators, we measure the runtime
both with and without event detection.</p>
<p>Here are the results:</p>
<img alt="Event detection benchmark" class="align-center" src="_images/event_det.png" />
<p>We can see how heyoka’s event detection system has a much lower overhead than the event detection system in
DifferentialEquations.jl. heyoka’s event detection system combines the free dense output from Taylor’s method
with state-of-the-art polynomial root finding techniques to provide an event-detection methodology which is
both rigorous and computationally efficient. By contrast, DifferentialEquations.jl adopts the approach
of checking for sign changes in the event equation using the interpolant of the solution
within a timestep at discrete points. Note that
this approach is not rigorous, in the sense that if the event equation has two zeroes between the interpolation
points the event will be missed. By contrast, heyoka’s approach does not suffer from this issue.</p>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="tut_ensemble.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Ensemble propagations</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="ad_notes.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notes on automatic differentiation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Francesco Biscani, Dario Izzo<br/>
    
        &copy; Copyright 2020, 2021 Francesco Biscani, Dario Izzo.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>