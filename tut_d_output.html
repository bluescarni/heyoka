
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Dense &amp; continuous output &#8212; heyoka 4.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=a1c85040"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tut_d_output';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Event detection" href="tut_events.html" />
    <link rel="prev" title="Non-autonomous systems" href="tut_nonauto.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/white_logo.png" class="logo__image only-light" alt="heyoka 4.0.0 documentation - Home"/>
    <script>document.write(`<img src="_static/white_logo.png" class="logo__image only-dark" alt="heyoka 4.0.0 documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="basic_tutorials.html">Basic tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tut_taylor_method.html">Taylorâ€™s method</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_expression_system.html">The expression system</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_adaptive.html">The adaptive integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_adaptive_custom.html">Customising the adaptive integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_param.html">Runtime parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_nonauto.html">Non-autonomous systems</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Dense &amp; continuous output</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_events.html">Event detection</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="advanced_tutorials.html">Advanced tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tut_batch_mode.html">Batch mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_extended_precision.html">Computations in extended precision</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_arbitrary_precision.html">Computations in arbitrary precision</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_single_precision.html">Computations in single precision</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_s11n.html">Serialisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_ensemble.html">Ensemble propagations</a></li>
<li class="toctree-l2"><a class="reference internal" href="tut_parallel_mode.html">Parallel mode</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api_reference.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="definitions.html">Macros and definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="kwargs.html">Keyword arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">Exceptions</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="expression_system.html">Expression system</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="variable.html">Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="number.html">Numerical constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="param.html">Runtime parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="func.html">N-ary functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="expression.html">Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="math.html">Mathematical functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="ad_notes.html">Notes on automatic differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="breaking_changes.html">Breaking changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgement.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/bluescarni/heyoka" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bluescarni/heyoka/issues/new?title=Issue%20on%20page%20%2Ftut_d_output.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/tut_d_output.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Dense & continuous output</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dense-output-for-the-step-functions">Dense output for the <code class="docutils literal notranslate"><span class="pre">step()</span></code> functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dense-output-for-the-propagate-functions">Dense output for the <code class="docutils literal notranslate"><span class="pre">propagate_*()</span></code> functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-output">Continuous output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code-listing">Full code listing</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="dense-continuous-output">
<span id="tut-d-output"></span><h1>Dense &amp; continuous output<a class="headerlink" href="#dense-continuous-output" title="Link to this heading">#</a></h1>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.4.0.</span></p>
</div>
<p>One of the peculiar features of Taylorâ€™s method is that it directly provides,
via the Taylor series <a class="reference internal" href="tut_taylor_method.html#equation-tts-01">(4)</a>, <em>dense</em> (or <em>continuous</em>) output.
That is, the Taylor series built by the integrator at each timestep can be used
to compute the solution of the ODE system at <em>any time</em> within the timestep
(and not only at the endpoint) via polynomial evaluation.</p>
<p>Because the construction of the Taylor series is part of the timestepping algorithm,
support for dense output comes at essentially no extra
cost. Additionally, because the dense output is computed via the
Taylor series of the solution of the ODE system, its accuracy
is guaranteed to respect the error tolerance set in the integrator.</p>
<p>Dense output can be used either from a low-level API, which gives direct
access to the coefficients of the Taylor polynomials of the solution
within a timestep, or from a higher-level
API, which facilitates the common use case of using the coefficients
of the Taylor polynomials to compute the continuous extension
of the solution. If you are interested only in the latter,
you can skip the next sections and jump directly to the
<a class="reference internal" href="#tut-c-output"><span class="std std-ref">continuous output section</span></a>.</p>
<section id="dense-output-for-the-step-functions">
<h2>Dense output for the <code class="docutils literal notranslate"><span class="pre">step()</span></code> functions<a class="headerlink" href="#dense-output-for-the-step-functions" title="Link to this heading">#</a></h2>
<p>In order to illustrate how to use dense output in heyoka,
we will keep things simple and go back to the simple pendulum:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Create the symbolic variables x and v.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_vars</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create the integrator object</span>
<span class="w">    </span><span class="c1">// in double precision.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taylor_adaptive</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">{</span><span class="c1">// Definition of the ODE system:</span>
<span class="w">                                      </span><span class="c1">// x&#39; = v</span>
<span class="w">                                      </span><span class="c1">// v&#39; = -9.8 * sin(x)</span>
<span class="w">                                      </span><span class="p">{</span><span class="n">prime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">prime</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span>
<span class="w">                                      </span><span class="c1">// Initial conditions</span>
<span class="w">                                      </span><span class="c1">// for x and v.</span>
<span class="w">                                      </span><span class="p">{</span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.025</span><span class="p">}};</span>
</pre></div>
</div>
<p>Enabling dense output for the <code class="docutils literal notranslate"><span class="pre">step()</span></code> functions in heyoka is a two-step process.
The first step is to invoke one of the <code class="docutils literal notranslate"><span class="pre">step()</span></code> functions
passing an extra boolean parameter set to <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Integrate for a single timestep, and store</span>
<span class="w">    </span><span class="c1">// the Taylor coefficients in the integrator.</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The extra <code class="docutils literal notranslate"><span class="pre">true</span></code> function argument instructs the integrator
to record into an internal array the list of Taylor series
coefficients that were generated by the timestepping algorithm.
We can fetch a reference to the list of Taylor coefficients
via the <code class="docutils literal notranslate"><span class="pre">get_tc()</span></code> member function:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Fetch the Taylor coefficients of order 0</span>
<span class="w">    </span><span class="c1">// for x and v.</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;TC of order 0 for x: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">get_tc</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;TC of order 0 for v: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">get_tc</span><span class="p">()[</span><span class="n">ta</span><span class="p">.</span><span class="n">get_order</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1u</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>The Taylor coefficients are stored in row-major order,
each row referring to a different state variable. The number
of columns is the Taylor order of the integrator plus one.
Thus, index 0 in the array refers to the zero-order coefficient
for the <code class="docutils literal notranslate"><span class="pre">x</span></code> variable, while index <code class="docutils literal notranslate"><span class="pre">ta.get_order()</span> <span class="pre">+</span> <span class="pre">1</span></code> refers
to the zero-order coefficient for the <code class="docutils literal notranslate"><span class="pre">v</span></code> variable:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">TC of order 0 for x: 0.05</span>
<span class="go">TC of order 0 for v: 0.025</span>
</pre></div>
</div>
<p>Indeed, the zero-order Taylor coefficients for the state variables are nothing but
the initial conditions at the beginning of the timestep that was just taken.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This last point is important and needs to be stressed again: the list of Taylor
coefficients always refers to the <strong>last</strong> step taken and <strong>not</strong> to the next
step that the integrator might take.</p>
</div>
<p>We are now ready to ask the integrator to compute the value of the solution at some
arbitrary time. Letâ€™s pick <span class="math notranslate nohighlight">\(t = 0.1\)</span>,
which is about halfway through the timestep that was just taken:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Compute and print the dense output at t = 0.1.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">update_d_output</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x(0.1) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;y(0.1) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">x(0.1) = 0.0500303</span>
<span class="go">y(0.1) = -0.024398</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">update_d_output()</span></code> member function takes in input an <em>absolute</em> time coordinate
and returns a reference to an internal array that will contain the state of the system
at the specified time coordinate, as computed by the evaluation of the Taylor series.
<code class="docutils literal notranslate"><span class="pre">update_d_output()</span></code> can also be called with a time coordinate <em>relative</em> to the current
time by passing <code class="docutils literal notranslate"><span class="pre">true</span></code> as a second function argument.</p>
<p>Letâ€™s now ask for the dense output at the very end of the timestep that was just taken,
and letâ€™s compare it to the current state vector:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Compute the dense output at the end of the</span>
<span class="w">    </span><span class="c1">// previous timestep and compare it to the current</span>
<span class="w">    </span><span class="c1">// state vector.</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">update_d_output</span><span class="p">(</span><span class="n">ta</span><span class="p">.</span><span class="n">get_time</span><span class="p">());</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">get_state</span><span class="p">();</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x rel. difference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">d_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;v rel. difference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">d_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">x rel. difference: 0</span>
<span class="go">v rel. difference: -0</span>
</pre></div>
</div>
<p>That is, as expected, the dense output at the end of the previous timestep
matches the current state of the system to machine precision.</p>
<p>Before concluding, we need to highlight a couple of caveats regarding the
use of dense output.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>First, it is the userâ€™s responsibility to ensure that the array of Taylor
coefficients contains up-to-date values. In other words, the user needs to remember
to invoke the <code class="docutils literal notranslate"><span class="pre">step()</span></code> functions with the extra boolean argument set to <code class="docutils literal notranslate"><span class="pre">true</span></code>
before invoking <code class="docutils literal notranslate"><span class="pre">update_d_output()</span></code>.
Failure to do so will result in <code class="docutils literal notranslate"><span class="pre">update_d_output()</span></code> producing incorrect values.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Second, the accuracy of dense output is guaranteed to match the integratorâ€™s
accuracy only if the time coordinate falls within the last step taken. Note that heyoka will
<strong>not</strong> prevent the invocation of <code class="docutils literal notranslate"><span class="pre">update_d_output()</span></code> with time coordinates outside the
guaranteed accuracy range - it is the userâ€™s responsibility to be aware
that doing so will produce results whose accuracy does not match the integratorâ€™s
error tolerance.</p>
</div>
</section>
<section id="dense-output-for-the-propagate-functions">
<h2>Dense output for the <code class="docutils literal notranslate"><span class="pre">propagate_*()</span></code> functions<a class="headerlink" href="#dense-output-for-the-propagate-functions" title="Link to this heading">#</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.0.</span></p>
</div>
<p>Dense output can be enabled also for the time-limited propagation functions
<code class="docutils literal notranslate"><span class="pre">propagate_for()</span></code> and <code class="docutils literal notranslate"><span class="pre">propagate_until()</span></code> via the boolean keyword argument
<code class="docutils literal notranslate"><span class="pre">write_tc</span></code>.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">write_tc</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, the <code class="docutils literal notranslate"><span class="pre">propagate_*()</span></code> functions
will internally invoke the <code class="docutils literal notranslate"><span class="pre">step()</span></code> function with the optional boolean
flag set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, so that at the end of each timestep the Taylor coefficients
will be available. The Taylor coefficients can be used, e.g., inside the
step callback that can be passed to the <code class="docutils literal notranslate"><span class="pre">propagate_*()</span></code> functions.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">propagate_grid()</span></code> always unconditionally writes the Taylor coefficients
at the end of each timestep, and thus using the <code class="docutils literal notranslate"><span class="pre">write_tc</span></code> argument is not necessary.</p>
</section>
<section id="continuous-output">
<span id="tut-c-output"></span><h2>Continuous output<a class="headerlink" href="#continuous-output" title="Link to this heading">#</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.16.0.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">propagate_for()</span></code> and <code class="docutils literal notranslate"><span class="pre">propagate_until()</span></code> functions can optionally return
a function object providing <em>continuous output</em> in the integration interval.
That is, this function object can be used to compute the solution at <em>any</em> time
within the time interval covered by <code class="docutils literal notranslate"><span class="pre">propagate_for/until()</span></code>.</p>
<p>Let us see a concrete example of <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code> in action:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Reset time and state.</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">get_state_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">;</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">get_state_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">set_time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Integrate up to t = 10, and request continuous output.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">c_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ta</span><span class="p">.</span><span class="n">propagate_until</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="w"> </span><span class="n">kw</span><span class="o">::</span><span class="n">c_output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">));</span>
</pre></div>
</div>
<p>Continuous output can be requested via the <code class="docutils literal notranslate"><span class="pre">c_output</span></code> boolean keyword flag, and it is stored
as the fifth element of the tuple returned by <code class="docutils literal notranslate"><span class="pre">propagate_for/until()</span></code>. The <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code>
function object
is wrapped in a <code class="docutils literal notranslate"><span class="pre">std::optional</span></code> (so that when continuous output is not requested, the
<code class="docutils literal notranslate"><span class="pre">std::optional</span></code> will be empty).</p>
<p>Let us try to print <code class="docutils literal notranslate"><span class="pre">c_out</span></code> to screen:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Print to screen.</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">c_out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Direction : forward</span>
<span class="go">Time range: [0, 10)</span>
<span class="go">N of steps: 48</span>
</pre></div>
</div>
<p>The screen output informs us that the <code class="docutils literal notranslate"><span class="pre">c_out</span></code> object is capable of providing continuous output
in the <span class="math notranslate nohighlight">\(\left[ 0, 10 \right)\)</span> time interval, and that 48 steps were taken
during the integration.</p>
<p>Let us compute and print to screen the state of the system at a few time coordinates:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Compute and print to screen the system state</span>
<span class="w">    </span><span class="c1">// at different time coordinates.</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">4.3</span><span class="p">,</span><span class="w"> </span><span class="mf">6.7</span><span class="p">,</span><span class="w"> </span><span class="mf">8.9</span><span class="p">,</span><span class="w"> </span><span class="mf">10.</span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Compute the state at tm.</span>
<span class="w">        </span><span class="p">(</span><span class="o">*</span><span class="n">c_out</span><span class="p">)(</span><span class="n">tm</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Print it out:</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;time=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, x=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c_out</span><span class="o">-&gt;</span><span class="n">get_output</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="c1">//</span>
<span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, v=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c_out</span><span class="o">-&gt;</span><span class="n">get_output</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">time=0, x=0.05, v=0.025</span>
<span class="go">time=1.5, x=-0.0088572, v=0.156048</span>
<span class="go">time=4.3, x=0.0375906, v=-0.106177</span>
<span class="go">time=6.7, x=-0.0193535, v=-0.146456</span>
<span class="go">time=8.9, x=-0.0424699, v=-0.0862923</span>
<span class="go">time=10, x=0.0487397, v=0.0429423</span>
</pre></div>
</div>
<p>The call operator of <code class="docutils literal notranslate"><span class="pre">c_out</span></code> takes a time value <code class="docutils literal notranslate"><span class="pre">tm</span></code> as input, and computes and writes to
an internal buffer the value of the state vector at <code class="docutils literal notranslate"><span class="pre">tm</span></code>. The <code class="docutils literal notranslate"><span class="pre">get_output()</span></code> member function
returns a reference to the internal buffer containing the state of the system at <code class="docutils literal notranslate"><span class="pre">tm</span></code>.</p>
<p>As we can see from the screen output, the state vector at <span class="math notranslate nohighlight">\(t = 0\)</span> corresponds to the initial conditions.
The state vector at <span class="math notranslate nohighlight">\(t=10\)</span> (i.e., at the end of the integration interval) corresponds to the current
state of the integrator object.</p>
<p>Continuous output is somewhat similar to <code class="docutils literal notranslate"><span class="pre">propagate_grid()</span></code>, in the sense that both allow to compute
the value of the solution at arbitrary time points. <code class="docutils literal notranslate"><span class="pre">propagate_grid()</span></code> is computationally more efficient,
but it requires to specify up-front the list of times at which the solution should be computed.
Continuous output, on the other hand, is not bound to a predetermined time grid, and it can thus be helpful
if time coordinates of interest can be identified only after the solution has been computed.</p>
<p>Before concluding, we need to highlight a couple of caveats regarding the
use of <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code> function object stores internally the time coordinate
and Taylor coefficients at the end of each step taken during the integration interval.
This means that the memory usage of a <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code> object scales linearly
with the number of timesteps taken during the integration interval. Thus, for a sufficiently
long integration interval, the <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code> object might end up exhausting
the available memory.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Like for dense output, the accuracy of <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code> is guaranteed to match the integratorâ€™s
accuracy only if the time coordinate falls within the integration interval. Note that heyoka will
<strong>not</strong> prevent the use of a <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code> object outside the
guaranteed accuracy range - it is the userâ€™s responsibility to be aware
that doing so will produce results whose accuracy does not match the integratorâ€™s
error tolerance.</p>
</div>
<p>Note that, like the other main classes in heyoka, <code class="docutils literal notranslate"><span class="pre">continuous_output</span></code> supports
<a class="reference internal" href="tut_s11n.html#tut-s11n"><span class="std std-ref">serialisation</span></a>.</p>
</section>
<section id="full-code-listing">
<h2>Full code listing<a class="headerlink" href="#full-code-listing" title="Link to this heading">#</a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;heyoka/heyoka.hpp&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">heyoka</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Create the symbolic variables x and v.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_vars</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create the integrator object</span>
<span class="w">    </span><span class="c1">// in double precision.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taylor_adaptive</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">{</span><span class="c1">// Definition of the ODE system:</span>
<span class="w">                                      </span><span class="c1">// x&#39; = v</span>
<span class="w">                                      </span><span class="c1">// v&#39; = -9.8 * sin(x)</span>
<span class="w">                                      </span><span class="p">{</span><span class="n">prime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">prime</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span>
<span class="w">                                      </span><span class="c1">// Initial conditions</span>
<span class="w">                                      </span><span class="c1">// for x and v.</span>
<span class="w">                                      </span><span class="p">{</span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.025</span><span class="p">}};</span>

<span class="w">    </span><span class="c1">// Integrate for a single timestep, and store</span>
<span class="w">    </span><span class="c1">// the Taylor coefficients in the integrator.</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Fetch the Taylor coefficients of order 0</span>
<span class="w">    </span><span class="c1">// for x and v.</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;TC of order 0 for x: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">get_tc</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;TC of order 0 for v: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">get_tc</span><span class="p">()[</span><span class="n">ta</span><span class="p">.</span><span class="n">get_order</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1u</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Compute and print the dense output at t = 0.1.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">update_d_output</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x(0.1) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;y(0.1) = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Compute the dense output at the end of the</span>
<span class="w">    </span><span class="c1">// previous timestep and compare it to the current</span>
<span class="w">    </span><span class="c1">// state vector.</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">update_d_output</span><span class="p">(</span><span class="n">ta</span><span class="p">.</span><span class="n">get_time</span><span class="p">());</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ta</span><span class="p">.</span><span class="n">get_state</span><span class="p">();</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x rel. difference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">d_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;v rel. difference: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">d_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Reset time and state.</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">get_state_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">;</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">get_state_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.025</span><span class="p">;</span>
<span class="w">    </span><span class="n">ta</span><span class="p">.</span><span class="n">set_time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Integrate up to t = 10, and request continuous output.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">c_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ta</span><span class="p">.</span><span class="n">propagate_until</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="w"> </span><span class="n">kw</span><span class="o">::</span><span class="n">c_output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Print to screen.</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">c_out</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Compute and print to screen the system state</span>
<span class="w">    </span><span class="c1">// at different time coordinates.</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">4.3</span><span class="p">,</span><span class="w"> </span><span class="mf">6.7</span><span class="p">,</span><span class="w"> </span><span class="mf">8.9</span><span class="p">,</span><span class="w"> </span><span class="mf">10.</span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Compute the state at tm.</span>
<span class="w">        </span><span class="p">(</span><span class="o">*</span><span class="n">c_out</span><span class="p">)(</span><span class="n">tm</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Print it out:</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;time=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, x=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c_out</span><span class="o">-&gt;</span><span class="n">get_output</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="c1">//</span>
<span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, v=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">c_out</span><span class="o">-&gt;</span><span class="n">get_output</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tut_nonauto.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Non-autonomous systems</p>
      </div>
    </a>
    <a class="right-next"
       href="tut_events.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Event detection</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dense-output-for-the-step-functions">Dense output for the <code class="docutils literal notranslate"><span class="pre">step()</span></code> functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dense-output-for-the-propagate-functions">Dense output for the <code class="docutils literal notranslate"><span class="pre">propagate_*()</span></code> functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-output">Continuous output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code-listing">Full code listing</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Francesco Biscani, Dario Izzo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2020, 2021, 2022, 2023 Francesco Biscani, Dario Izzo.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>